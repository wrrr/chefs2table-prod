{"version":3,"file":"builder-react-lite.esm.js","sources":["../src/sdk-version.ts","../src/scripts/init-editing.ts","../src/functions/utils.ts","../src/constants/device-sizes.constant.ts","../src/functions/set.ts","../src/functions/safe-dynamic-require.ts","../src/functions/is-debug.ts","../src/functions/should-force-browser-runtime-in-node.ts","../src/functions/string-to-function.ts","../src/store/builder-async-requests.ts","../src/store/builder-store.ts","../src/functions/apply-patch-with-mutation.ts","../src/functions/block-to-html-string.ts","../src/components/Link.tsx","../src/functions/traverse.ts","../src/functions/extract-localized-values.ts","../src/components/builder-block.component.tsx","../src/components/builder-blocks.component.tsx","../src/components/no-wrap.tsx","../src/components/variants-provider.component.tsx","../src/components/builder-content.component.tsx","../lib/on-change.js","../src/functions/debonce-next-tick.ts","../src/functions/throttle.ts","../src/store/builder-meta.ts","../src/functions/try-eval.tsx","../src/to-error.ts","../src/functions/get-builder-pixel.ts","../src/components/builder-component.component.tsx","../src/functions/with-children.tsx","../src/hooks/useIsPreviewing.ts","../src/builder-react-lite.ts"],"sourcesContent":["export const SDK_VERSION = '8.2.8';\n","import { SDK_VERSION } from '../sdk-version';\n\nif (typeof window !== 'undefined') {\n  window.parent?.postMessage(\n    {\n      type: 'builder.isReactSdk',\n      data: {\n        value: true,\n        supportsPatchUpdates: 'v4',\n        supportsCustomBreakpoints: true,\n        supportsXSmallBreakpoint: true,\n        supportsGlobalSymbols: true,\n        blockLevelPersonalization: true,\n        version: SDK_VERSION,\n      },\n    },\n    '*'\n  );\n}\n","// TODO: pull from builder internal utils\nexport const fastClone = <T extends object>(obj: T): T => JSON.parse(JSON.stringify(obj));\n\nexport const omit = <T extends object>(obj: T, ...values: (keyof T)[]): Partial<T> => {\n  const newObject = Object.assign({}, obj);\n  for (const key of values) {\n    delete (newObject as any)[key];\n  }\n  return newObject;\n};\n","import { fastClone } from '../functions/utils';\n\nexport type Size = 'large' | 'medium' | 'small' | 'xsmall';\nexport const sizeNames: Size[] = ['xsmall', 'small', 'medium', 'large'];\n\n// TODO: put in @builder.io/core\nconst sizes = {\n  xsmall: {\n    min: 0,\n    default: 160,\n    max: 320,\n  },\n  small: {\n    min: 321,\n    default: 321,\n    max: 640,\n  },\n  medium: {\n    min: 641,\n    default: 642,\n    max: 991,\n  },\n  large: {\n    min: 990,\n    default: 991,\n    max: 1200,\n  },\n  getWidthForSize(size: Size) {\n    return this[size].default;\n  },\n  getSizeForWidth(width: number) {\n    for (const size of sizeNames) {\n      const value = this[size];\n      if (width <= value.max) {\n        return size;\n      }\n    }\n    return 'large';\n  },\n};\nexport type Sizes = typeof sizes;\n\nexport interface Breakpoints {\n  xsmall?: number;\n  small?: number;\n  medium?: number;\n}\n\nexport const getSizesForBreakpoints = (breakpoints: Breakpoints) => {\n  const newSizes = {\n    ...sizes, // Note: this helps get the function from sizes\n    ...fastClone(sizes), // Note: this helps to get a deep clone of fields like small, medium etc\n  };\n\n  if (!breakpoints) {\n    return newSizes;\n  }\n\n  const { xsmall, small, medium } = breakpoints;\n\n  if (xsmall) {\n    const xsmallMin = Math.floor(xsmall / 2);\n    newSizes.xsmall = {\n      max: xsmall,\n      min: xsmallMin,\n      default: xsmallMin + 1,\n    };\n  }\n\n  if (!small || !medium) {\n    return newSizes;\n  }\n\n  const smallMin = xsmall ? newSizes.xsmall.max + 1 : Math.floor(small / 2);\n  newSizes.small = {\n    max: small,\n    min: smallMin,\n    default: smallMin + 1,\n  };\n\n  const mediumMin = newSizes.small.max + 1;\n  newSizes.medium = {\n    max: medium,\n    min: mediumMin,\n    default: mediumMin + 1,\n  };\n\n  const largeMin = newSizes.medium.max + 1;\n  newSizes.large = {\n    max: 2000, // TODO: decide upper limit\n    min: largeMin,\n    default: largeMin + 1,\n  };\n\n  return newSizes;\n};\n","export const set = (obj: any, _path: string | string[], value: any) => {\n  if (Object(obj) !== obj) {\n    return obj;\n  }\n  const path: string[] = Array.isArray(_path)\n    ? _path\n    : (_path.toString().match(/[^.[\\]]+/g) as string[]);\n\n  path\n    .slice(0, -1)\n    .reduce(\n      (a, c, i) =>\n        Object(a[c]) === a[c]\n          ? a[c]\n          : (a[c] = Math.abs(Number(path[i + 1])) >> 0 === +path[i + 1] ? [] : {}),\n      obj\n    )[path[path.length - 1]] = value;\n  return obj;\n};\n","'use strict';\n\nimport { Builder } from '@builder.io/sdk';\n\nconst noop = () => null;\n// Allow us to require things dynamically safe from webpack bundling\n\nexport let safeDynamicRequire: typeof require;\n\n/*\n * The if condition below used to be\n *\n *     if (typeof globalThis.require === \"function\")\n *\n * That broke in case Builder was running on the server (Next, SSR use-cases) where\n * globalThis.require was undefined. Avoiding use of Builder.isServer for Cloudflare worker cases\n * That said, if change it to\n *\n * if (typeof require === 'function') {\n *   localSafeDynamicRequire = eval('require');\n * }\n *\n * Then the TSC / rollup compiler over-optimizes and replaces the if condition with true always\n * causing it to blow up on the client side. Hence this convoluted way of doing it.\n *\n * In Summary:\n *\n * 1. Node -> globalThis.require does not work\n * 2. Cloudflare edge -> only globalThis.require works\n */\nif (\n  typeof globalThis?.require === 'function' ||\n  (Builder.isServer && typeof require === 'function')\n) {\n  try {\n    /*\n      This is a hack to get around webpack bundling the require function, which is not available in the browser\n      Needs to be eval'd to avoid webpack bundling it\n    */\n    safeDynamicRequire = eval('require');\n  } catch (e) {\n    /* \n      This is a patch for enviornments where eval is not allowed, like Shopify-hydrogen storefront\n      Relevant issue : https://github.com/BuilderIO/builder-shopify-hydrogen/issues/12\n    */\n    if (globalThis?.require) {\n      safeDynamicRequire = globalThis.require;\n    } else {\n      // @ts-ignore\n      safeDynamicRequire = noop;\n    }\n  }\n}\n\nsafeDynamicRequire ??= noop as any;\n","export function isDebug(): boolean {\n  return Boolean(\n    typeof process !== 'undefined' && typeof process.env !== 'undefined' && process.env.DEBUG\n  );\n}\n","function isNodeRuntime(): boolean {\n  return typeof process !== 'undefined' && Boolean(process?.versions?.node);\n}\n\nexport const shouldForceBrowserRuntimeInNode = () => {\n  if (!isNodeRuntime()) return false;\n\n  const isArm64 = process.arch === 'arm64';\n  const isNode20 = process.version.startsWith('v20');\n\n  const hasNoNodeSnapshotNodeOption = process.env.NODE_OPTIONS?.includes('--no-node-snapshot');\n\n  if (isArm64 && isNode20 && !hasNoNodeSnapshotNodeOption) {\n    console.log(`Skipping usage of \\`isolated-vm\\` to avoid crashes in Node v20 on an arm64 machine.\n    If you would like to use the \\`isolated-vm\\` package on this machine, please provide the \\`NODE_OPTIONS=--no-node-snapshot\\` config to your Node process.\n    See https://github.com/BuilderIO/builder/blob/main/packages/react/README.md#node-v20--m1-macs-apple-silicon-support for more information.\n    `);\n\n    return true;\n  }\n\n  return false;\n};\n","import { Builder, builder } from '@builder.io/sdk';\nimport { safeDynamicRequire } from './safe-dynamic-require';\nimport { isDebug } from './is-debug';\nimport { shouldForceBrowserRuntimeInNode } from './should-force-browser-runtime-in-node';\n\nconst fnCache: { [key: string]: BuilderEvanFunction | undefined } = {};\n\ntype BuilderEvanFunction = (\n  state: object,\n  event?: Event | undefined | null,\n  block?: any,\n  builder?: Builder,\n  Device?: any,\n  update?: Function | null,\n  _Builder?: typeof Builder,\n  context?: object\n) => any;\n\nexport const api = (state: any) => builder;\n\nexport function stringToFunction(\n  str: string,\n  expression = true,\n  errors?: Error[],\n  logs?: string[]\n): BuilderEvanFunction {\n  /* TODO: objedct */\n  if (!str || !str.trim()) {\n    return () => undefined;\n  }\n\n  const cacheKey = str + ':' + expression;\n  if (fnCache[cacheKey]) {\n    return fnCache[cacheKey]!;\n  }\n\n  // FIXME: gross hack\n  const useReturn =\n    (expression &&\n      !(str.includes(';') || str.includes(' return ') || str.trim().startsWith('return '))) ||\n    str.trim().startsWith('builder.run');\n  let fn: Function = () => {\n    /* intentionally empty */\n  };\n\n  try {\n    // tslint:disable-next-line:no-function-constructor-with-string-args\n    if (Builder.isBrowser) {\n      // TODO: use strict and eval\n      fn = new Function(\n        'state',\n        'event',\n        'block',\n        'builder',\n        'Device',\n        'update',\n        'Builder',\n        'context',\n        // TODO: remove the with () {} - make a page v3 that doesn't use this\n        // Or only do if can't find state\\s*\\. anywhere hm\n        `\n          var names = [\n            'state',\n            'event',\n            'block',\n            'builder',\n            'Device',\n            'update',\n            'Builder',\n            'context'\n          ];\n          var rootState = state;\n          if (typeof Proxy !== 'undefined') {\n            rootState = new Proxy(rootState, {\n              set: function () {\n                return false;\n              },\n              get: function (target, key) {\n                if (names.includes(key)) {\n                  return undefined;\n                }\n                return target[key];\n              }\n            });\n          }\n          /* Alias */\n          var ctx = context;\n          var log = console.log.bind(console);\n          with (rootState) {\n            ${useReturn ? `return (${str});` : str};\n          }\n        `\n      );\n    }\n  } catch (error: any) {\n    if (errors) {\n      errors.push(error);\n    }\n    const message = error && error.message;\n    if (message && typeof message === 'string') {\n      if (logs && logs.indexOf(message) === -1) {\n        logs.push(message);\n      }\n    }\n    if (Builder.isBrowser) {\n      console.warn(`Function compile error in ${str}`, error);\n    }\n  }\n\n  const final = (...args: any[]) => {\n    try {\n      if (Builder.isBrowser || shouldForceBrowserRuntimeInNode()) {\n        return fn(...args);\n      } else {\n        // TODO: memoize on server\n        // TODO: use something like this instead https://www.npmjs.com/package/rollup-plugin-strip-blocks\n        // There must be something more widely used?\n        // TODO: regex for between comments instead so can still type check the code... e.g. //SERVER-START ... code ... //SERVER-END\n        // Below is a hack to get certain code to *only* load in the server build, to not screw with\n        // browser bundler's like rollup and webpack. Our rollup plugin strips these comments only\n        // for the server build\n        // TODO: cache these for better performancs with new VmScript\n        const isolateContext: import('isolated-vm').Context = getIsolateContext();\n        const ivm = safeDynamicRequire('isolated-vm') as typeof import('isolated-vm');\n        const resultStr = isolateContext.evalClosureSync(\n          makeFn(str, useReturn),\n          args.map((arg, index) =>\n            typeof arg === 'object'\n              ? new ivm.Reference(\n                  index === indexOfBuilderInstance\n                    ? {\n                        // workaround: methods with default values for arguments is not being cloned over\n                        ...arg,\n                        getUserAttributes: () => arg.getUserAttributes(''),\n                      }\n                    : arg\n                )\n              : null\n          )\n        );\n        try {\n          // returning objects throw errors in isolated vm, so we stringify it and parse it back\n          const res = JSON.parse(resultStr);\n          return res;\n        } catch (_error: any) {\n          return resultStr;\n        }\n      }\n    } catch (error: any) {\n      if (Builder.isBrowser) {\n        console.warn(\n          'Builder custom code error:',\n          error.message || error,\n          'in',\n          str,\n          error.stack || error\n        );\n      } else {\n        if (isDebug()) {\n          console.debug(\n            'Builder custom code error:',\n            error.message || error,\n            'in',\n            str,\n            error.stack || error\n          );\n        }\n      }\n      if (errors) {\n        errors.push(error);\n      }\n      return null;\n    }\n  };\n\n  if (Builder.isBrowser) {\n    fnCache[cacheKey] = final;\n  }\n\n  return final;\n}\n\nconst indexOfBuilderInstance = 3;\n\nexport const makeFn = (code: string, useReturn: boolean, args?: string[]) => {\n  // Order must match the order of the arguments to the function\n  const names = args || [\n    'state',\n    'event',\n    'block',\n    'builder',\n    'Device',\n    'update',\n    'Builder',\n    'context',\n  ];\n\n  // Convert all argument references to proxies, and pass `copySync` method to target object, to return a copy of the original JS object\n  // https://github.com/laverdet/isolated-vm#referencecopysync\n  const refToProxyFn = `\n  var refToProxy = (obj) => {\n    if (typeof obj !== 'object' || obj === null) {\n      return obj;\n    }\n    return new Proxy({}, {\n        get(target, key) {\n            if (key === 'copySync') {\n              return () => obj.copySync();\n            }\n            const val = obj.getSync(key);\n            if (typeof val?.copySync === 'function') {\n                return JSON.parse(stringify(val));\n            }\n            return val;\n        },\n        set(target, key, value) {\n            obj.setSync(key, value);\n        },\n        deleteProperty(target, key) {\n            obj.deleteSync(key);\n        }\n      })\n  }\n`;\n  // Returned object  will be stringified and parsed back to the parent isolate\n  const strinfigyFn = `\n    var stringify = (val) => {\n      if (typeof val === 'object' && val !== null) {\n        return JSON.stringify(val.copySync ? val.copySync() : val);\n      }\n      return val;\n    }\n  `;\n\n  return `\n${refToProxyFn}\n${strinfigyFn}\n`.concat(names.map((arg, index) => `var ${arg} = refToProxy($${index});`).join('\\n')).concat(`\n${names.includes('context') ? 'var ctx = context;' : ''}\nvar endResult = function() {\n  ${useReturn ? `return (${code});` : code};\n};\n\nreturn stringify(endResult());\n`);\n};\n\nexport const getIsolateContext = () => {\n  let isolatedContext = Builder.serverContext;\n\n  if (!isolatedContext) {\n    const ivm = safeDynamicRequire('isolated-vm') as typeof import('isolated-vm');\n    const isolate = new ivm.Isolate({ memoryLimit: 128 });\n    isolatedContext = isolate.createContextSync();\n    Builder.setServerContext(isolatedContext);\n  }\n  const jail = isolatedContext!.global;\n  // This makes the global object available in the context as `global`. We use `derefInto()` here\n  // because otherwise `global` would actually be a Reference{} object in the new isolate.\n  jail.setSync('global', jail.derefInto());\n  // We will create a basic `log` function for the new isolate to use.\n  jail.setSync('log', function (...args: any[]) {\n    if (isDebug()) {\n      console.log(...args);\n    }\n  });\n  return isolatedContext;\n};\n","import React from 'react';\n\nexport interface RequestInfo {\n  promise: Promise<any>;\n  url?: string;\n}\n\nexport type RequestOrPromise = RequestInfo | Promise<any>;\n\nexport const isPromise = (thing: RequestOrPromise): thing is Promise<any> =>\n  typeof (thing as any).then === 'function';\nexport const isRequestInfo = (thing: RequestOrPromise): thing is RequestInfo => !isPromise(thing);\n\nexport const BuilderAsyncRequestsContext = React.createContext({\n  requests: [] as RequestOrPromise[],\n  errors: [] as Error[],\n  logs: [] as string[],\n});\n","import React from 'react';\n\nexport const BuilderStoreContext = React.createContext<BuilderStore>({\n  state: {},\n  rootState: {},\n  content: {},\n  context: {},\n  update: (mutator: (state: any) => any) => null,\n});\n\nexport interface BuilderStore {\n  state: any;\n  rootState: any;\n  content: any;\n  context: any;\n  update: (mutator: (state: any) => any) => any;\n  renderLink?: (props: React.AnchorHTMLAttributes<any>) => React.ReactNode;\n}\n","export const applyPatchWithMinimalMutationChain = <T extends object>(\n  obj: T,\n  patch: { path: string; op: 'add' | 'remove' | 'replace'; value: any },\n  preserveRoot = false\n): T => {\n  if (Object(obj) !== obj) {\n    return obj;\n  }\n  const { path, op, value } = patch;\n  const pathArr: string[] = path.split(/\\//);\n  if (pathArr[0] === '') {\n    pathArr.shift();\n  }\n\n  const newObj = preserveRoot ? obj : { ...obj };\n  let objPart = newObj as any;\n  for (let i = 0; i < pathArr.length; i++) {\n    const isLast = i === pathArr.length - 1;\n    const property = pathArr[i];\n    if (isLast) {\n      if (op === 'replace') {\n        objPart[property] = value;\n      } else if (op === 'add') {\n        const index = Number(property);\n        if (Array.isArray(objPart)) {\n          if (property === '-') {\n            objPart.push(value);\n          } else {\n            objPart.splice(index, 0, value);\n          }\n        } else {\n          objPart[property] = value;\n        }\n      } else if (op === 'remove') {\n        const index = Number(property);\n        if (Array.isArray(objPart)) {\n          objPart.splice(index, 1);\n        } else {\n          delete objPart[property];\n        }\n      }\n    } else {\n      const nextProperty = pathArr[i + 1];\n      const newPart =\n        Object(objPart[property]) === objPart[property]\n          ? objPart[property]\n          : String(Number(nextProperty)) === nextProperty\n            ? []\n            : {};\n      objPart = objPart[property] = Array.isArray(newPart) ? [...newPart] : { ...newPart };\n    }\n  }\n\n  return newObj;\n};\n","import { BuilderElement } from '@builder.io/sdk';\n\nexport const htmlEscape = (str: string) =>\n  str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n\n// TODO: handle self closing tags\n// TODO: how allow components (e.g. react components) in templates?\nexport const blockToHtmlString = (block: BuilderElement): string =>\n  `<${htmlEscape(block.tagName || 'div')} \n    class=\"builder-block ${block.id} ${block.class || ''}\"\n    builder-id=\"${block.id}\"\n  ${Object.keys(block.properties || {})\n    .map(key => `${htmlEscape(key)}=\"${htmlEscape(block.properties![key])}\"`)\n    .join(' ')}\n  >${\n    block?.component?.name === 'Text'\n      ? block.component.options.text\n      : block.children\n        ? block.children.map(item => blockToHtmlString(item)).join('')\n        : ''\n  }</${block.tagName || 'div'}>`.replace(/\\s+/g, ' ');\n","'use client';\nimport React from 'react';\nimport { BuilderStoreContext } from '../store/builder-store';\n/**\n * Link component should be used instead of an anchor tag in our components,\n * this is to allow our users to override anchor tags in\n * case they're using a routing Lib that requires using their\n * custom Link component (e.g Next, Gatsby, React Router)\n * <BuilderComponent renderLink=(props) => <myCustomLink {...props} /> />\n */\nexport const Link = (props: React.AnchorHTMLAttributes<HTMLAnchorElement>) => (\n  <BuilderStoreContext.Consumer>\n    {context => {\n      if (context.renderLink) {\n        return context.renderLink(props);\n      }\n      return <a {...props} />;\n    }}\n  </BuilderStoreContext.Consumer>\n);\n","type TraverseCallback = (value: any, update: (newValue: any) => void) => void;\n\n/**\n * Recursively traverses an object or array, invoking a callback on each value.\n *\n * @param {any} obj - The object or array to traverse. Can also handle primitives, null, or undefined.\n * @param {TraverseCallback} callback - The function to invoke on each value. Receives the current value\n * and an `update` function to modify the value in its parent container.\n * @param {any} [parent=null] - The parent object or array of the current value. Used internally.\n * @param {any} [key=null] - The key or index of the current value in its parent. Used internally.\n * @param {WeakSet} [visited=new WeakSet()] - Tracks visited objects to handle circular references. Used internally.\n *\n * @example\n * // Example: Doubling all numbers in an object\n * const obj = { a: 1, b: [2, 3, { c: 4 }] };\n * traverse(obj, (value, update) => {\n *   if (typeof value === 'number') {\n *     update(value * 2);\n *   }\n * });\n * console.log(obj); // { a: 2, b: [4, 6, { c: 8 }] }\n *\n * @example\n * // Example: Handling circular references\n * const obj = { a: 1 };\n * obj.self = obj;\n * traverse(obj, (value, update) => {\n *   if (typeof value === 'number') {\n *     update(value * 2);\n *   }\n * });\n * console.log(obj.a); // 2\n */\nexport function traverse(\n  obj: any,\n  callback: TraverseCallback,\n  parent: any = null,\n  key: any = null,\n  visited = new WeakSet()\n): void {\n  if (obj == null || typeof obj !== 'object') {\n    callback(obj, (newValue: any) => {\n      if (parent !== null && key !== null) {\n        parent[key] = newValue;\n      }\n    });\n    return;\n  }\n\n  if (visited.has(obj)) {\n    return;\n  }\n  visited.add(obj);\n\n  if (Array.isArray(obj)) {\n    obj.forEach((item, index) => {\n      const update = (newValue: any) => {\n        obj[index] = newValue;\n      };\n      callback(item, update);\n      traverse(item, callback, obj, index, visited);\n    });\n  } else {\n    Object.entries(obj).forEach(([key, value]) => {\n      const update = (newValue: any) => {\n        obj[key] = newValue;\n      };\n      callback(value, update);\n      traverse(value, callback, obj, key, visited);\n    });\n  }\n}\n","import { traverse } from './traverse';\n\nconst isLocalizedField = (value: any) => {\n  return value && typeof value === 'object' && value['@type'] === '@builder.io/core:LocalizedValue';\n};\n\nexport const containsLocalizedValues = (data: Record<string, any>) => {\n  if (!data || !Object.getOwnPropertyNames(data).length) {\n    return false;\n  }\n  let hasLocalizedValues = false;\n  traverse(data, value => {\n    if (isLocalizedField(value)) {\n      hasLocalizedValues = true;\n      return;\n    }\n  });\n  return hasLocalizedValues;\n};\n\nexport const extractLocalizedValues = (data: Record<string, any>, locale: string) => {\n  if (!data || !Object.getOwnPropertyNames(data).length) {\n    return {};\n  }\n\n  traverse(data, (value, update) => {\n    if (isLocalizedField(value)) {\n      update(value[locale] ?? undefined);\n    }\n  });\n\n  return data;\n};\n","/** @jsx jsx */\nimport { Builder, builder, BuilderElement, Component } from '@builder.io/sdk';\nimport { ClassNames, jsx } from '@emotion/core';\nimport React from 'react';\nimport { getSizesForBreakpoints, Size, sizeNames } from '../constants/device-sizes.constant';\nimport { set } from '../functions/set';\nimport { api, stringToFunction } from '../functions/string-to-function';\nimport { BuilderAsyncRequestsContext, RequestOrPromise } from '../store/builder-async-requests';\nimport { BuilderStoreContext } from '../store/builder-store';\nimport { applyPatchWithMinimalMutationChain } from '../functions/apply-patch-with-mutation';\nimport { blockToHtmlString } from '../functions/block-to-html-string';\nimport { Link } from './Link';\nimport { fastClone } from '../functions/utils';\nimport {\n  containsLocalizedValues,\n  extractLocalizedValues,\n} from 'src/functions/extract-localized-values';\n\nconst camelCaseToKebabCase = (str?: string) =>\n  str ? str.replace(/([A-Z])/g, g => `-${g[0].toLowerCase()}`) : '';\n\nconst kebabCaseToCamelCase = (str = '') =>\n  str.replace(/-([a-z])/g, match => match[1].toUpperCase());\n\nconst Device = { desktop: 0, tablet: 1, mobile: 2 };\n\n// Deep clone a block but without cloning any child blocks\nexport function deepCloneWithConditions<T = any>(obj: T): T {\n  if (obj === null || typeof obj !== 'object') {\n    return obj;\n  }\n\n  if (Array.isArray(obj)) {\n    return obj.map((item: any) => deepCloneWithConditions(item)) as T;\n  }\n\n  if ((obj as any)['@type'] === '@builder.io/sdk:Element') {\n    return obj;\n  }\n\n  const clonedObj: any = {};\n\n  for (const key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n      if (key === 'meta') {\n        clonedObj.meta = obj['meta'];\n      } else {\n        clonedObj[key] = deepCloneWithConditions(obj[key]);\n      }\n    }\n  }\n\n  return clonedObj;\n}\n\nconst voidElements = new Set([\n  'area',\n  'base',\n  'br',\n  'col',\n  'embed',\n  'hr',\n  'img',\n  'input',\n  'link',\n  'meta',\n  'param',\n  'source',\n  'track',\n  'wbr',\n  'textarea', // In React, we want to treat this as void (no children, otherwise React throws errors)\n]);\n\nconst last = <T extends any>(arr: T[]) => arr[arr.length - 1];\n\nfunction omit(obj: any, values: string[]) {\n  const newObject = Object.assign({}, obj);\n  for (const key of values) {\n    delete newObject[key];\n  }\n  return newObject;\n}\n\nconst cssCase = (property: string) => {\n  if (!property) {\n    return property;\n  }\n\n  let str = camelCaseToKebabCase(property);\n\n  if (property[0] === property[0].toUpperCase()) {\n    str = '-' + str;\n  }\n\n  return str;\n};\n\n// TODO: share these types in shared\ntype ElementType = any;\n\nexport interface BuilderBlockProps {\n  fieldName?: string;\n  block: BuilderElement;\n  // TODO:\n  // block: BuilderElement\n  child?: boolean;\n  index?: number;\n  size?: Size;\n  emailMode?: boolean;\n  // TODO: use context\n}\n\nfunction capitalize(str: string) {\n  if (!str) {\n    return;\n  }\n  return str[0].toUpperCase() + str.slice(1);\n}\n\ninterface BuilderBlockState {\n  state: any;\n  rootState: any;\n  context: any;\n  update: Function;\n}\n\nexport class BuilderBlock extends React.Component<\n  BuilderBlockProps,\n  { hasError: boolean; updates: number }\n> {\n  private _asyncRequests?: RequestOrPromise[];\n  private _errors?: Error[];\n  private _logs?: string[];\n\n  hydrated = false;\n\n  state = {\n    hasError: false,\n    updates: 0,\n  };\n\n  private privateState: BuilderBlockState = {\n    state: {},\n    rootState: {},\n    context: {},\n    update: () => {\n      /* Intentionally empty */\n    },\n  };\n\n  get store() {\n    return this.privateState;\n  }\n\n  static getDerivedStateFromError(error: any) {\n    return { hasError: true };\n  }\n\n  componentDidCatch(error: any, errorInfo: any) {\n    console.error('Builder block error:', error, errorInfo);\n  }\n\n  // TODO: handle adding return if none provided\n  // TODO: cache/memoize this (globally with LRU?)\n  stringToFunction(str: string, expression = true) {\n    return stringToFunction(str, expression, this._errors, this._logs);\n  }\n\n  get block() {\n    return this.props.block;\n  }\n\n  emotionCss(responsiveStyles: BuilderElement['responsiveStyles']) {\n    let initialAnimationStepStyles: any;\n    const { block } = this;\n    const animation = block.animations && block.animations[0];\n    if (animation && animation.trigger !== 'hover') {\n      const firstStep = animation && animation.steps && animation.steps[0];\n      const stepStyles = firstStep && firstStep.styles;\n      if (stepStyles) {\n        initialAnimationStepStyles = stepStyles;\n      }\n    }\n\n    const reversedNames = sizeNames.slice().reverse();\n    const styles: any = {};\n    if (responsiveStyles) {\n      const contentHasXSmallBreakpoint = Boolean(\n        this.privateState.context.builderContent?.meta?.breakpoints?.xsmall\n      );\n      for (const size of reversedNames) {\n        if (!contentHasXSmallBreakpoint && size === 'xsmall') {\n          // Only apply xsmall styles if xsmall breakpoint is enabled on content\n          continue;\n        }\n\n        if (size === 'large') {\n          if (!this.props.emailMode) {\n            styles[`&.builder-block`] = Object.assign(\n              {},\n              responsiveStyles[size],\n              initialAnimationStepStyles\n            );\n          }\n        } else {\n          const sizesPerBreakpoints = getSizesForBreakpoints(\n            this.privateState.context.builderContent?.meta?.breakpoints || {}\n          );\n          styles[`@media only screen and (max-width: ${sizesPerBreakpoints[size].max}px)`] = {\n            '&.builder-block': responsiveStyles[size],\n          };\n        }\n      }\n    }\n\n    const hoverAnimation =\n      block.animations && block.animations.find(item => item.trigger === 'hover');\n    if (hoverAnimation) {\n      styles[':hover'] = hoverAnimation.steps?.[1]?.styles || {};\n      // TODO: if manually has set transition property deal with that\n      // TODO: only include properties explicitly set in the animation\n      // using Object.keys(styles)\n      styles.transition = `all ${hoverAnimation.duration}s ${camelCaseToKebabCase(\n        hoverAnimation.easing\n      )}`;\n      if (hoverAnimation.delay) {\n        styles.transitionDelay = hoverAnimation.delay + 's';\n      }\n    }\n\n    return styles;\n  }\n\n  eval(str: string) {\n    const fn = this.stringToFunction(str);\n    // TODO: only one root instance of this, don't rewrap every time...\n    return fn(\n      this.privateState.state,\n      undefined,\n      this.block,\n      builder,\n      Device,\n      this.privateState.update,\n      Builder,\n      this.privateState.context\n    );\n  }\n\n  componentWillUnmount() {\n    if (Builder.isEditing) {\n      removeEventListener('message', this.onWindowMessage);\n    }\n  }\n\n  onWindowMessage = (event: MessageEvent) => {\n    const message = event.data;\n    if (!message) {\n      return;\n    }\n    switch (message.type) {\n      case 'builder.selectionChange': {\n        const { data } = message;\n        if (!data) {\n          break;\n        }\n        const { selection } = data;\n        const id = this.block && this.block.id;\n        if (id && Array.isArray(selection) && selection.indexOf(id) > -1) {\n          setTimeout(() => {\n            (window as any).$block = this;\n            if (!(window as any).$blocks) {\n              (window as any).$blocks = [];\n            }\n            (window as any).$blocks.push(this);\n          });\n        }\n        break;\n      }\n\n      case 'builder.patchUpdates': {\n        const { data } = message;\n        if (!(data && data.data)) {\n          break;\n        }\n        const patches = data.data[this.block.id!];\n        if (!patches) {\n          return;\n        }\n\n        if (location.href.includes('builder.debug=true')) {\n          eval('debugger');\n        }\n        for (const patch of patches) {\n          applyPatchWithMinimalMutationChain(this.props.block, patch, true);\n        }\n        this.setState({ updates: this.state.updates + 1 });\n\n        break;\n      }\n    }\n  };\n\n  componentDidMount() {\n    this.hydrated = true;\n    const block = this.block;\n    const animations = block && block.animations;\n\n    if (Builder.isEditing) {\n      addEventListener('message', this.onWindowMessage);\n    }\n\n    // tslint:disable-next-line:comment-format\n    ///REACT15ONLY if (this.ref) { this.ref.setAttribute('builder-id', block.id); }\n\n    if (animations) {\n      const options = {\n        animations: fastClone(animations),\n      };\n\n      // TODO: listen to Builder.editingMode and bind animations when editing\n      // and unbind when not\n      // TODO: apply bindings first\n      if (block.bindings) {\n        for (const key in block.bindings) {\n          if (!key.trim?.()) {\n            continue;\n          }\n\n          if (key.startsWith('animations.')) {\n            // TODO: this needs to run in getElement bc of local state per element for repeats\n            const value = this.stringToFunction(block.bindings[key]);\n            if (value !== undefined) {\n              set(\n                options,\n                key,\n                value(\n                  this.privateState.state,\n                  null,\n                  block,\n                  builder,\n                  null,\n                  null,\n                  Builder,\n                  this.privateState.context\n                )\n              );\n            }\n          }\n        }\n      }\n      Builder.animator.bindAnimations(\n        options.animations\n          .filter((item: any) => item.trigger !== 'hover')\n          .map((animation: any) => ({\n            ...animation,\n            elementId: this.block.id,\n          }))\n      );\n    }\n  }\n\n  // <!-- Builder Blocks --> in comments hmm\n  getElement(index = 0, state = this.privateState.state): React.ReactNode {\n    const { child, fieldName } = this.props;\n    const block = this.block;\n    let TagName: string | typeof Link = (block.tagName || 'div').toLowerCase();\n\n    if (TagName === 'template') {\n      const html = block.children\n        ? block.children.map(item => blockToHtmlString(item)).join(' ')\n        : '';\n      console.debug('template html', html);\n      return (\n        // React has an undesired behavior (for us) for template tags, so we must\n        // turn the contents into a string\n        <template\n          {...block.properties}\n          dangerouslySetInnerHTML={{\n            __html: html,\n          }}\n        />\n      );\n    }\n\n    let InnerComponent: any;\n    const componentName =\n      block.component && (block.component.name || (block.component as any).component);\n    let componentInfo: Component | null = null;\n    if (block.component && !(block.component as any).class) {\n      if (block.component && block.component.tag) {\n        InnerComponent = block.component.tag;\n      } else {\n        componentInfo = Builder.components.find(item => item.name === componentName) || null;\n        if (componentInfo && componentInfo.class) {\n          InnerComponent = componentInfo.class;\n        } else if (componentInfo && componentInfo.tag) {\n          InnerComponent = componentInfo.tag;\n        } else {\n          if (componentName?.startsWith('Builder:')) {\n            console.warn(\n              `Missing @builder.io/widgets installation, please install and import @builder.io/widgets to use ${\n                componentName.split(':')[1]\n              } in your content, more info here: https://github.com/BuilderIO/builder/tree/main/packages/widgets`\n            );\n          } else if (componentName) {\n            console.warn(\n              `Missing registration for ${componentName}, have you included the registration in your bundle?`\n            );\n          }\n        }\n      }\n    }\n\n    const TextTag: any = 'span';\n\n    let options: any = {\n      ...block.properties,\n      style: {},\n      responsiveStyles: fastClone(block.responsiveStyles || {}),\n    };\n\n    options = {\n      ...options.properties,\n      ...options,\n    };\n\n    if (block.component) {\n      options.component = deepCloneWithConditions(block.component);\n    }\n\n    // Binding should be properties to href or href?\n    // Manual style editor show bindings\n    // Show if things bound in overlays hmm\n    if (block.bindings) {\n      for (const key in block.bindings) {\n        if (!key.trim?.()) {\n          continue;\n        }\n\n        const value = this.stringToFunction(block.bindings[key]);\n        // TODO: pass block, etc\n        set(\n          options,\n          key,\n          value(state, null, block, api(state), Device, null, Builder, this.privateState.context)\n        );\n      }\n    }\n\n    if (options.hide) {\n      return null;\n    } else {\n      delete options.hide;\n    }\n    // TODO: UI for this\n    if (('show' in options || (block.bindings && block.bindings.show)) && !options.show) {\n      return null;\n    } else {\n      delete options.show;\n    }\n\n    if (block.actions) {\n      for (const key in block.actions) {\n        if (!key.trim?.()) {\n          continue;\n        }\n\n        const value = block.actions[key];\n        options['on' + capitalize(key)] = (event: any) => {\n          let useState = state;\n          if (typeof Proxy !== 'undefined') {\n            useState = new Proxy(state, {\n              set: (obj, prop, value) => {\n                obj[prop] = value;\n                this.privateState.rootState[prop] = value;\n                return true;\n              },\n            });\n          }\n          const fn = this.stringToFunction(value, false);\n          // TODO: only one root instance of this, don't rewrap every time...\n          return fn(\n            useState,\n            event,\n            this.block,\n            builder,\n            Device,\n            this.privateState.update,\n            Builder,\n            this.privateState.context\n          );\n        };\n      }\n    }\n\n    let innerComponentProperties = (options.component || options.options) && {\n      ...options.options,\n      ...(options.component.options || options.component.data),\n    };\n\n    if (containsLocalizedValues(innerComponentProperties)) {\n      if (!this.privateState.state.locale) {\n        console.warn(\n          '[Builder.io] In order to use localized fields in Builder, you must pass a locale prop to the BuilderComponent or to options object while fetching the content to resolve localized fields. Learn more: https://www.builder.io/c/docs/localization-inline#targeting-and-inline-localization'\n        );\n      }\n      innerComponentProperties = extractLocalizedValues(\n        innerComponentProperties,\n        this.privateState.state.locale ?? 'Default'\n      );\n    }\n\n    const isVoid = voidElements.has(TagName);\n\n    const noWrap = componentInfo && (componentInfo.fragment || componentInfo.noWrap);\n\n    const styleStr =\n      options.attr?.style || (typeof options.style === 'string' ? options.style : '') || '';\n\n    if (typeof styleStr === 'string') {\n      if (typeof options.style !== 'object') {\n        options.style = {};\n      }\n\n      const styleSplit = styleStr.split(';');\n      for (const pair of styleSplit) {\n        const stylePieces = pair.split(':');\n        if (!stylePieces.length) {\n          return;\n        }\n\n        let [key, value] = stylePieces;\n\n        if (!key) {\n          continue;\n        }\n\n        if (stylePieces.length > 2) {\n          value = stylePieces.slice(1).join(':');\n        }\n\n        options.style[kebabCaseToCamelCase(key)] = value;\n      }\n    }\n\n    const finalOptions: { [key: string]: string } = {\n      ...omit(options, ['class', 'component', 'attr', 'responsiveStyles']),\n      [typeof TagName === 'string' && !TagName.includes('-') ? 'className' : 'class']:\n        `builder-block ${this.id}${block.class ? ` ${block.class}` : ''}${\n          block.component && !(['Image', 'Video', 'Banner'].indexOf(componentName) > -1)\n            ? ` builder-has-component`\n            : ''\n        }` +\n        (options.class ? ' ' + options.class : '') +\n        (this.hydrated && Builder.isEditing && this.privateState.state._spacer?.parent === block.id\n          ? ' builder-spacer-parent'\n          : ''),\n      key: this.id + index,\n      'builder-id': this.id,\n      // ...(state && state.$index && typeof state.$index === 'number'\n      //   ? {\n      // TODO: ONLY include on repeat!\n      // TODO: what if dymically repeated by another component like tabs... may not work.\n      // need function to provide that right\n      ...(index !== 0 && {\n        'builder-index': index, // String(state.$index)\n      }),\n      //   }\n      // : null)\n    };\n\n    // tslint:disable-next-line:comment-format\n    ///REACT15ONLY finalOptions.className = finalOptions.class\n\n    if (Builder.isEditing && this.hydrated) {\n      // TODO: removed bc JS can add styles inline too?\n      (finalOptions as any)['builder-inline-styles'] = !(options.attr && options.attr.style)\n        ? ''\n        : Object.keys(options.style).reduce(\n            (memo, key) => (memo ? `${memo};` : '') + `${cssCase(key)}:${options.style[key]};`,\n            ''\n          );\n    }\n\n    if (\n      (((finalOptions as any).properties && (finalOptions as any).properties.href) ||\n        (finalOptions as any).href) &&\n      TagName === 'div'\n    ) {\n      TagName = 'a';\n    }\n\n    if (TagName === 'a') {\n      TagName = Link;\n    }\n    // const css = this.css\n\n    // const styleTag = css.trim() && (\n    //   <style className=\"builder-style\">\n    //     {(InnerComponent && !isBlock ? `.${this.id} > * { height: 100%; width: 100%; }` : '') +\n    //       this.css}\n    //   </style>\n    // )\n\n    const children = block.children || finalOptions.children || [];\n\n    // TODO: test it out\n    return (\n      <React.Fragment>\n        {/* <InsertSpacer id={block.id!} position=\"before\" /> */}\n        <ClassNames>\n          {({ css, cx }) => {\n            if (!this.props.emailMode) {\n              const addClass = ' ' + css(this.emotionCss(options.responsiveStyles));\n              if (finalOptions.class) {\n                finalOptions.class += addClass;\n              }\n              if (finalOptions.className) {\n                finalOptions.className += addClass;\n              }\n            }\n\n            return (\n              <BuilderAsyncRequestsContext.Consumer>\n                {value => {\n                  this._asyncRequests = value && value.requests;\n                  this._errors = value && value.errors;\n                  this._logs = value && value.logs;\n                  return isVoid ? (\n                    <TagName {...finalOptions} />\n                  ) : InnerComponent && (noWrap || this.props.emailMode) ? (\n                    // TODO: pass the class to be easier\n                    // TODO: acceptsChildren option?\n                    <InnerComponent\n                      // Final options maaay be wrong here hm\n                      {...innerComponentProperties}\n                      // should really call this builderAttributes bc people can name a\n                      // componet input \"attributes\"\n                      attributes={finalOptions}\n                      builderBlock={block}\n                      builderState={this.privateState}\n                    />\n                  ) : (\n                    <TagName {...(finalOptions as any)}>\n                      {InnerComponent && (\n                        <InnerComponent\n                          builderState={this.privateState}\n                          builderBlock={block}\n                          {...innerComponentProperties}\n                        />\n                      )}\n                      {(block as any).text || options.text\n                        ? options.text\n                        : !InnerComponent && children && Array.isArray(children) && children.length\n                          ? children.map((block: ElementType, index: number) => (\n                              <BuilderBlock\n                                key={((this.id as string) || '') + index}\n                                block={block}\n                                index={index}\n                                size={this.props.size}\n                                fieldName={this.props.fieldName}\n                                child={this.props.child}\n                                emailMode={this.props.emailMode}\n                              />\n                            ))\n                          : null}\n                    </TagName>\n                  );\n                }}\n              </BuilderAsyncRequestsContext.Consumer>\n            );\n          }}\n        </ClassNames>\n        {/* <InsertSpacer id={block.id!} position=\"after\" /> */}\n      </React.Fragment>\n    );\n  }\n\n  get id(): string {\n    const { block } = this;\n    if (block.id && !block.id.startsWith('builder')) {\n      return 'builder-' + block.id;\n    }\n    return block.id || '';\n  }\n\n  contents(state: BuilderBlockState) {\n    const block = this.block;\n\n    // this.setState(state);\n    this.privateState = state;\n\n    if (block.repeat && block.repeat.collection) {\n      const collectionPath = block.repeat.collection;\n      const collectionName = last((collectionPath || '').trim().split('(')[0].trim().split('.'));\n      const itemName = block.repeat.itemName || (collectionName ? collectionName + 'Item' : 'item');\n      const array = this.stringToFunction(collectionPath)(\n        state.state,\n        null,\n        block,\n        api(state),\n        Device,\n        null,\n        Builder,\n        this.privateState.context\n      );\n      if (Array.isArray(array)) {\n        return array.map((data, index) => {\n          // TODO: Builder state produce the data\n          const childState = {\n            ...state.state,\n            $index: index,\n            $item: data,\n            [itemName]: data,\n            [`$${itemName}Index`]: index,\n          };\n\n          return (\n            <BuilderStoreContext.Provider\n              key={index}\n              value={{ ...state, state: childState } as any}\n            >\n              {this.getElement(index, childState)}\n            </BuilderStoreContext.Provider>\n          );\n        });\n      }\n      return null;\n    }\n\n    return this.getElement();\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return (\n        <span\n          css={{\n            display: 'inline-block',\n            padding: 5,\n            color: '#999',\n            fontSize: 11,\n            fontStyle: 'italic',\n          }}\n        >\n          Builder block error :( Check console for details\n        </span>\n      );\n    }\n    return (\n      <BuilderStoreContext.Consumer>{value => this.contents(value)}</BuilderStoreContext.Consumer>\n    );\n  }\n}\n","/** @jsx jsx */\nimport { jsx } from '@emotion/core';\nimport React from 'react';\nimport { Builder } from '@builder.io/sdk';\nimport { BuilderBlock } from './builder-block.component';\n// TODO: fetch these for user and send them with same response like graphql\nimport { Size } from '../constants/device-sizes.constant';\nimport ReactDOM from 'react-dom';\nimport { BuilderStoreContext } from '../store/builder-store';\n\nexport interface BuilderBlocksProps {\n  fieldName?: string;\n  // TODO: block type (ElementType[])\n  blocks?: any[] | React.ReactNode;\n  child?: boolean;\n  // TODO: use new react context for this to pass window size all the way down\n  size?: Size;\n  style?: React.CSSProperties;\n  parentElementId?: string;\n  parent?: any;\n  dataPath?: string;\n  className?: string;\n  emailMode?: boolean;\n}\n\ninterface BuilderBlocksState {\n  // width: number\n}\n\n// TODO: options to set direciotn\nexport class BuilderBlocks extends React.Component<BuilderBlocksProps, BuilderBlocksState> {\n  hydrated = false;\n  get isRoot() {\n    return !this.props.child;\n  }\n\n  get noBlocks() {\n    const { blocks } = this.props;\n    return !(blocks && (blocks as any).length); // TODO: allow react nodes\n  }\n  get path() {\n    const pathPrefix = 'component.options.';\n    let path = this.props.dataPath || '';\n    const thisPrefix = 'this.';\n    if (path.trim()) {\n      if (path.startsWith(thisPrefix)) {\n        path = path.replace(thisPrefix, '');\n      } else if (!path.startsWith(pathPrefix)) {\n        path = pathPrefix + path;\n      }\n    }\n    return path;\n  }\n\n  get parentId() {\n    if (this.props.parentElementId) {\n      return this.props.parentElementId;\n    }\n    return this.props.parent && this.props.parent.id;\n  }\n\n  componentDidMount() {\n    this.hydrated = true;\n  }\n\n  onClickEmptyBlocks = () => {\n    if (Builder.isIframe && this.noBlocks) {\n      window.parent?.postMessage(\n        {\n          type: 'builder.clickEmptyBlocks',\n          data: {\n            parentElementId: this.parentId,\n            dataPath: this.path,\n          },\n        },\n        '*'\n      );\n    }\n  };\n  onHoverEmptyBlocks = () => {\n    if (Builder.isEditing && this.noBlocks) {\n      window.parent?.postMessage(\n        {\n          type: 'builder.hoverEmptyBlocks',\n          data: {\n            parentElementId: this.parentId,\n            dataPath: this.path,\n          },\n        },\n        '*'\n      );\n    }\n  };\n\n  // <!-- Builder Blocks --> in comments hmm\n  render() {\n    const { blocks } = this.props;\n\n    const TagName = this.props.emailMode ? 'span' : 'div';\n\n    // TODO: how deep check this automatically for mobx... hmmm optional / peer dependency?\n    return (\n      // TODO: component <Stack direction=\"vertical\">\n      // TODO: react.fragment instead?\n      <TagName\n        className={\n          'builder-blocks' +\n          (this.noBlocks ? ' no-blocks' : '') +\n          (this.props.child ? ' builder-blocks-child' : '') +\n          (this.props.className ? ' ' + this.props.className : '')\n        }\n        builder-type=\"blocks\"\n        builder-path={Builder.isIframe && this.hydrated ? this.path : undefined}\n        builder-parent-id={this.parentId}\n        css={\n          {\n            ...(!this.props.emailMode && {\n              display: 'flex',\n              flexDirection: 'column',\n              alignItems: 'stretch',\n            }),\n            ...this.props.style,\n          } as any\n        }\n        onClick={() => {\n          if (this.noBlocks) {\n            this.onClickEmptyBlocks();\n          }\n        }}\n        {...(Builder.isEditing && {\n          onMouseEnter: () => this.onHoverEmptyBlocks(),\n        })}\n      >\n        {/* TODO: if is react node (for react compatibility) render it */}\n        {/* TODO: maybe don't do this to preserve blocks always editable */}\n        {(blocks &&\n          Array.isArray(blocks) &&\n          (blocks as any[]).map((block, index) =>\n            block && block['@type'] === '@builder.io/sdk:Element' ? (\n              <BuilderBlock\n                key={block.id}\n                block={block}\n                index={index}\n                fieldName={this.props.fieldName}\n                child={this.props.child}\n                emailMode={this.props.emailMode}\n              />\n            ) : (\n              block\n            )\n          )) ||\n          blocks}\n      </TagName>\n    );\n  }\n\n  static renderInto(\n    elementOrSelector: string | HTMLElement,\n    props: BuilderBlocksProps = {},\n    builderState: any\n  ) {\n    if (!elementOrSelector) {\n      return;\n    }\n\n    let element: Element | null = null;\n\n    if (typeof elementOrSelector === 'string') {\n      element = document.querySelector(elementOrSelector);\n    } else {\n      if (elementOrSelector instanceof Element) {\n        element = elementOrSelector;\n      }\n    }\n    return ReactDOM.render(\n      <BuilderStoreContext.Provider value={builderState}>\n        <BuilderBlocks {...props} />\n      </BuilderStoreContext.Provider>,\n      element\n    );\n  }\n}\n","'use client';\nimport React from 'react';\n\nexport const NoWrap = (props: React.ComponentPropsWithoutRef<any>) => props.children;\n","'use client';\nimport * as React from 'react';\nimport { builder, Builder, BuilderContent, BuilderContentVariation } from '@builder.io/sdk';\n\nfunction getData(content: BuilderContentVariation) {\n  if (typeof content?.data === 'undefined') {\n    return undefined;\n  }\n\n  const { blocks, blocksString } = content.data;\n  const hasBlocks = Array.isArray(blocks) || typeof blocksString === 'string';\n  const newData: any = {\n    ...content.data,\n    ...(hasBlocks && { blocks: blocks || JSON.parse(blocksString) }),\n  };\n\n  delete newData.blocksString;\n  return newData;\n}\n\nconst variantsScript = (variantsString: string, contentId: string) =>\n  `\n(function() {\n  if (window.builderNoTrack || !navigator.cookieEnabled) {\n    return;\n  }\n\n  var variants = ${variantsString};\n  function removeVariants() {\n    variants.forEach(function (template) {\n      document.querySelector('template[data-template-variant-id=\"' + template.id + '\"]').remove();\n    });\n    document.getElementById('variants-script-${contentId}').remove();\n  }\n\n  if (typeof document.createElement(\"template\").content === 'undefined') {\n    removeVariants();\n    return ;\n  }\n\n  function setCookie(name,value,days) {\n    var expires = \"\";\n    if (days) {\n        var date = new Date();\n        date.setTime(date.getTime() + (days*24*60*60*1000));\n        expires = \"; expires=\" + date.toUTCString();\n    }\n    document.cookie = name + \"=\" + (value || \"\")  + expires + \"; path=/\" + \"; Secure; SameSite=None\";\n  }\n\n  function getCookie(name) {\n    var nameEQ = name + \"=\";\n    var ca = document.cookie.split(';');\n    for(var i=0;i < ca.length;i++) {\n        var c = ca[i];\n        while (c.charAt(0)==' ') c = c.substring(1,c.length);\n        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);\n    }\n    return null;\n  }\n  var cookieName = 'builder.tests.${contentId}';\n  var variantInCookie = getCookie(cookieName);\n  var availableIDs = variants.map(function(vr) { return vr.id }).concat('${contentId}');\n  var variantId;\n  if (availableIDs.indexOf(variantInCookie) > -1) {\n    variantId = variantInCookie;\n  }\n  if (!variantId) {\n    var n = 0;\n    var random = Math.random();\n    for (var i = 0; i < variants.length; i++) {\n      var variant = variants[i];\n      var testRatio = variant.testRatio;\n      n += testRatio;\n      if (random < n) {\n        setCookie(cookieName, variant.id);\n        variantId = variant.id;\n        break;\n      }\n    }\n    if (!variantId) {\n      variantId = \"${contentId}\";\n      setCookie(cookieName, \"${contentId}\");\n    }\n  }\n  if (variantId && variantId !== \"${contentId}\") {\n    var winningTemplate = document.querySelector('template[data-template-variant-id=\"' + variantId + '\"]');\n    if (winningTemplate) {\n      var parentNode = winningTemplate.parentNode;\n      var newParent = parentNode.cloneNode(false);\n      newParent.appendChild(winningTemplate.content.firstChild);\n      parentNode.parentNode.replaceChild(newParent, parentNode);\n    }\n  } else if (variants.length > 0) {\n    removeVariants();\n  }\n})()`.replace(/\\s+/g, ' ');\n\ninterface VariantsProviderProps {\n  initialContent: BuilderContent;\n  children: (variants: BuilderContent[], renderScript?: () => JSX.Element) => JSX.Element;\n  nonce?: string;\n}\n\nexport const VariantsProvider = ({ initialContent, children, nonce }: VariantsProviderProps) => {\n  if (Builder.isBrowser && !builder.canTrack) {\n    return children([initialContent]);\n  }\n\n  const hasTests = Boolean(Object.keys(initialContent?.variations || {}).length);\n\n  if (!hasTests) return children([initialContent]);\n\n  const variants: BuilderContent[] = Object.keys(initialContent.variations!).map(id => ({\n    id,\n    ...initialContent.variations![id],\n    data: getData(initialContent.variations![id]!),\n  }));\n\n  const allVariants = [...variants, initialContent];\n  if (Builder.isServer) {\n    const variantsJson = JSON.stringify(\n      Object.keys(initialContent.variations || {}).map(item => ({\n        id: item,\n        testRatio: initialContent.variations![item]!.testRatio,\n      }))\n    );\n    const renderScript = () => (\n      <script\n        nonce={nonce}\n        id={`variants-script-${initialContent.id}`}\n        dangerouslySetInnerHTML={{\n          __html: variantsScript(variantsJson, initialContent.id!),\n        }}\n      ></script>\n    );\n\n    // render all variants on the server side\n    return <React.Fragment>{children(allVariants, renderScript)}</React.Fragment>;\n  }\n\n  const cookieName = `builder.tests.${initialContent.id}`;\n\n  let variantId = builder.getCookie(cookieName);\n\n  if (!variantId && Builder.isBrowser) {\n    let n = 0;\n    const random = Math.random();\n    for (let i = 0; i < variants.length; i++) {\n      const variant = variants[i];\n      const testRatio = variant.testRatio;\n      n += testRatio!;\n      if (random < n) {\n        builder.setCookie(cookieName, variant.id);\n        variantId = variant.id;\n        break;\n      }\n    }\n  }\n\n  if (!variantId) {\n    // render initial content when no winning variation or on the server\n    variantId = initialContent.id;\n    builder.setCookie(cookieName, variantId);\n  }\n\n  return children([allVariants.find(item => item.id === variantId)!]);\n};\n","'use client';\nimport React from 'react';\nimport {\n  builder,\n  Subscription,\n  GetContentOptions,\n  Builder,\n  BuilderContent as Content,\n} from '@builder.io/sdk';\nimport { NoWrap } from './no-wrap';\nimport { applyPatchWithMinimalMutationChain } from '../functions/apply-patch-with-mutation';\nimport { VariantsProvider } from './variants-provider.component';\n\nexport type BuilderContentProps<ContentType> = {\n  /**\n   * Callback to run when content is fetched and loaded.\n   */\n  contentLoaded?: (data: any, content: any) => void;\n  /**\n   * Callback to run if an error occurred while fetching content.\n   */\n  contentError?: (error: any) => void;\n  options?: GetContentOptions;\n  children: (content: ContentType, loading?: boolean, fullData?: any) => React.ReactNode;\n  /**\n   * Only render what was explicitly passed in via `content` - don't fetch from\n   * the Builder API.\n   *\n   * @see content\n   */\n  inline?: boolean;\n  /**\n   * @package\n   * @deprecated\n   */\n  dataOnly?: boolean;\n  /**\n   * @package\n   * Pass in a specific builder instance to use instead of the default\n   * singleton.\n   */\n  builder?: Builder;\n  /**\n   * @deprecated and unnecessary\n   */\n  isStatic?: boolean;\n  /**\n   * Builder content object to use instead of fetching from the API.\n   *\n   * Required if `inline` is set to `true`.\n   */\n  content?: Content;\n  /**\n   * CSP nonce to allow the loading and execution of a script or style tag when Content-Security-Policy is enabled.\n   */\n  nonce?: string;\n} & ({ model: string } | { modelName: string }); // model and modelName are aliases of the same thing¸\n\n/**\n * When passed content json explicitly it'll calculate a/b tests on the content\n * and pass the winning variation down to the children function. If then content\n * prop was omitted it'll try to fetch matching content from your Builder\n * account based on the default user attributes and model.\n */\nexport class BuilderContent<ContentType extends object = any> extends React.Component<\n  BuilderContentProps<ContentType>\n> {\n  ref: HTMLDivElement | null = null;\n\n  get builder() {\n    return this.props.builder || builder;\n  }\n  get name() {\n    const props = this.props;\n\n    if ('model' in props) {\n      return props.model;\n    } else {\n      return props.modelName;\n    }\n  }\n\n  get renderedVariantId() {\n    const id = this.props.isStatic\n      ? this.builder.getCookie(`builder.tests.${this.data?.id}`)\n      : this.data?.variationId;\n    if (id !== null) {\n      return id;\n    }\n  }\n\n  get options() {\n    let options = {\n      ...(this.props.options || ({} as GetContentOptions)),\n    };\n    if (!options.key && this.props.content?.id && !Builder.isEditing && !Builder.isPreviewing) {\n      options.key = this.props.content.id;\n    }\n    if (\n      this.props.content &&\n      !options.initialContent?.length &&\n      (this.props.inline || !Builder.isPreviewing)\n    ) {\n      options.initialContent = [this.props.content];\n    }\n\n    return options;\n  }\n\n  get data() {\n    const content: Content =\n      ((this.props.inline || !Builder.isBrowser || this.firstLoad) &&\n        this.options.initialContent &&\n        this.options.initialContent[0]) ||\n      this.state.data;\n\n    return getContentWithInfo(content);\n  }\n\n  state = {\n    loading: !this.props.content,\n    data: getContentWithInfo(this.props.content),\n    updates: 1,\n  };\n\n  onWindowMessage = (event: MessageEvent) => {\n    const isTrusted = Builder.isTrustedHostForEvent(event);\n    if (!isTrusted) return;\n\n    const message = event.data;\n    if (!message) {\n      return;\n    }\n    switch (message.type) {\n      case 'builder.patchUpdates': {\n        if (this.props.options?.noEditorUpdates) {\n          return;\n        }\n        const { data } = message;\n        if (!(data && data.data)) {\n          break;\n        }\n        const patches = data.data[this.state.data?.id!];\n        if (!(patches && patches.length)) {\n          return;\n        }\n\n        if (location.href.includes('builder.debug=true')) {\n          eval('debugger');\n        }\n        let newData = this.state.data as any;\n        for (const patch of patches) {\n          newData = applyPatchWithMinimalMutationChain(newData, patch, false);\n        }\n        this.setState({\n          updates: this.state.updates + 1,\n          data: newData,\n        });\n        if (this.props.contentLoaded) {\n          this.props.contentLoaded(newData.data, newData);\n        }\n        break;\n      }\n    }\n  };\n\n  subscriptions = new Subscription();\n\n  firstLoad = true;\n  clicked = false;\n  trackedImpression = false;\n\n  intersectionObserver: IntersectionObserver | null = null;\n\n  // TODO: observe model name for changes\n  componentDidMount() {\n    // Temporary to test metrics diving in with bigquery and heatmaps\n    // this.builder.autoTrack = true;\n    // this.builder.env = 'development';\n    if (!this.props.inline || Builder.isEditing || Builder.isPreviewing) {\n      this.subscribeToContent();\n    } else if (this.props.inline && this.options?.initialContent?.length) {\n      const contentData = this.options.initialContent[0];\n      // TODO: intersectionobserver like in subscribetocontent - reuse the logic\n      if (contentData?.id) {\n        this.builder.trackImpression(contentData.id, this.renderedVariantId, undefined, {\n          content: contentData,\n        });\n      }\n    }\n\n    if (Builder.isEditing) {\n      addEventListener('message', this.onWindowMessage);\n    }\n\n    /// REACT15ONLY if (this.ref) { this.ref.setAttribute('builder-model', this.name); }\n  }\n\n  subscribeToContent() {\n    if (this.name !== '_inline') {\n      // TODO:... using targeting...? express.request hmmm\n      this.subscriptions.add(\n        this.builder.queueGetContent(this.name, this.options).subscribe(\n          matches => {\n            const match = matches && matches[0];\n            this.setState({\n              data: match,\n              loading: false,\n            });\n            // when BuilderContent is wrapping a BuilderComponent of the same model, the BuilderComponent is passing initialContent on the same key\n            // causing the sdk to resolve this call to the initialContent instead of the previewed/edited content\n            // so we test here if the BuilderContent is being used directly ( not inlined ) and it has initial content ( content prop ), we let the first render go through to show the initial content\n            // and we subscribe again to get the draft/editing content\n            const isPreviewing =\n              (this.builder.editingModel || this.builder.previewingModel) === this.name;\n            if (!this.props.inline && this.props.content && this.firstLoad && isPreviewing) {\n              this.firstLoad = false;\n              this.subscriptions.unsubscribe();\n              this.subscribeToContent();\n            }\n\n            if (match && this.firstLoad) {\n              this.firstLoad = false;\n              // TODO: autoTrack\n              if (builder.autoTrack && !Builder.isEditing) {\n                let addedObserver = false;\n                if (typeof IntersectionObserver === 'function' && this.ref) {\n                  try {\n                    const observer = (this.intersectionObserver = new IntersectionObserver(\n                      (entries, observer) => {\n                        entries.forEach(entry => {\n                          // In view\n                          if (entry.intersectionRatio > 0 && !this.trackedImpression) {\n                            this.builder.trackImpression(\n                              match.id!,\n                              this.renderedVariantId,\n                              undefined,\n                              {\n                                content: this.data,\n                              }\n                            ),\n                              { content: this.data };\n                            this.trackedImpression = true;\n                            if (this.ref) {\n                              observer.unobserve(this.ref);\n                            }\n                          }\n                        });\n                      }\n                    ));\n\n                    observer.observe(this.ref);\n                    addedObserver = true;\n                  } catch (err) {\n                    console.warn('Could not bind intersection observer');\n                  }\n                }\n                if (!addedObserver) {\n                  this.trackedImpression = true;\n                  this.builder.trackImpression(match.id!, this.renderedVariantId, undefined, {\n                    content: match,\n                  });\n                }\n              }\n            }\n            if (this.props.contentLoaded) {\n              this.props.contentLoaded(match && match.data, match);\n            }\n          },\n          error => {\n            if (this.props.contentError) {\n              this.props.contentError(error);\n              this.setState({\n                loading: false,\n              });\n            }\n          }\n        )\n      );\n    }\n  }\n\n  componentWillUnmount() {\n    if (Builder.isEditing) {\n      removeEventListener('message', this.onWindowMessage);\n    }\n\n    this.subscriptions.unsubscribe();\n    if (this.intersectionObserver && this.ref) {\n      this.intersectionObserver.unobserve(this.ref);\n    }\n  }\n\n  onClick = (reactEvent: React.MouseEvent<HTMLElement>) => {\n    // TODO: viewport scrolling tracking for impression events\n    const event = reactEvent.nativeEvent;\n\n    const content = this.data;\n    if (!content) {\n      return;\n    }\n    if (builder.autoTrack) {\n      this.builder.trackInteraction(content.id!, this.renderedVariantId, this.clicked, event, {\n        content,\n      });\n    }\n    if (!this.clicked) {\n      this.clicked = true;\n    }\n  };\n\n  render() {\n    if (this.props.dataOnly) {\n      return null;\n    }\n    const { loading } = this.state;\n\n    const useData: any = this.data;\n    const TagName = this.props.dataOnly ? NoWrap : 'div';\n    return (\n      <VariantsProvider initialContent={useData} nonce={this.props.nonce}>\n        {(variants, renderScript) => {\n          return (\n            <React.Fragment>\n              {variants.map((content, index) => {\n                // default Variation is at the end, wrap the rest with template\n                // TODO: IE11 don't support templates\n                const Tag = index === variants.length - 1 ? React.Fragment : 'template';\n                return (\n                  <React.Fragment key={String(content?.id! + index)}>\n                    {Tag !== 'template' && renderScript?.()}\n                    <Tag\n                      key={String(content?.id! + index)}\n                      {...(Tag === 'template' && {\n                        'data-template-variant-id': content?.id,\n                      })}\n                    >\n                      <TagName\n                        {...(index === 0 &&\n                          !this.props.dataOnly && {\n                            ref: (ref: any) => (this.ref = ref),\n                          })}\n                        className=\"builder-content\"\n                        onClick={this.onClick}\n                        builder-content-id={content?.id}\n                        builder-model={this.name}\n                      >\n                        {this.props.children(\n                          content?.data! as any,\n                          this.props.inline ? false : loading,\n                          useData\n                        )}\n                      </TagName>\n                    </Tag>\n                  </React.Fragment>\n                );\n              })}\n            </React.Fragment>\n          );\n        }}\n      </VariantsProvider>\n    );\n  }\n}\n\nexport const getContentWithInfo = (content?: Content) => {\n  if (content) {\n    const cookieValue = builder.getCookie(`builder.tests.${content.id}`);\n    const cookieVariation =\n      cookieValue === content.id ? content : content.variations?.[cookieValue];\n    const variationName =\n      cookieVariation?.name || (cookieVariation?.id === content.id ? 'Default variation' : '');\n\n    return {\n      ...content,\n      variationId: cookieValue,\n      testVariationId: cookieValue,\n      testVariationName: variationName,\n    };\n  }\n  return null;\n};\n","// Via https://github.com/sindresorhus/on-change but\n// compiled for ES5\n\n'use strict';\nObject.defineProperty(exports, '__esModule', { value: true });\n('use strict');\nvar PATH_SEPARATOR = '.';\nvar TARGET = Symbol('target');\nvar UNSUBSCRIBE = Symbol('unsubscribe');\nvar isPrimitive = function (value) {\n  return value === null || (typeof value !== 'object' && typeof value !== 'function');\n};\nvar isBuiltinWithoutMutableMethods = function (value) {\n  return value instanceof RegExp || value instanceof Number;\n};\nvar isBuiltinWithMutableMethods = function (value) {\n  return value instanceof Date;\n};\nvar concatPath = function (path, property) {\n  if (property && property.toString) {\n    if (path) {\n      path += PATH_SEPARATOR;\n    }\n    path += property.toString();\n  }\n  return path;\n};\nvar walkPath = function (path, callback) {\n  var index;\n  while (path) {\n    index = path.indexOf(PATH_SEPARATOR);\n    if (index === -1) {\n      index = path.length;\n    }\n    callback(path.slice(0, index));\n    path = path.slice(index + 1);\n  }\n};\nvar shallowClone = function (value) {\n  if (Array.isArray(value)) {\n    return value.slice();\n  }\n  return Object.assign({}, value);\n};\nvar onChange = function (object, onChange, options) {\n  if (typeof Proxy === 'undefined') {\n    // TODO: use immer? or a technique like immer to diff maybe\n    return object;\n  }\n  if (options === void 0) {\n    options = {};\n  }\n  var proxyTarget = Symbol('ProxyTarget');\n  var inApply = false;\n  var changed = false;\n  var applyPath;\n  var applyPrevious;\n  var isUnsubscribed = false;\n  var equals = options.equals || Object.is;\n  var propCache = new WeakMap();\n  var pathCache = new WeakMap();\n  var proxyCache = new WeakMap();\n  var handleChange = function (path, property, previous, value) {\n    if (isUnsubscribed) {\n      return;\n    }\n    if (!inApply) {\n      onChange(concatPath(path, property), value, previous);\n      return;\n    }\n    if (\n      inApply &&\n      applyPrevious &&\n      previous !== undefined &&\n      value !== undefined &&\n      property !== 'length'\n    ) {\n      var item_1 = applyPrevious;\n      if (path !== applyPath) {\n        path = path.replace(applyPath, '').slice(1);\n        walkPath(path, function (key) {\n          item_1[key] = shallowClone(item_1[key]);\n          item_1 = item_1[key];\n        });\n      }\n      item_1[property] = previous;\n    }\n    changed = true;\n  };\n  var getOwnPropertyDescriptor = function (target, property) {\n    var props = propCache ? propCache.get(target) : undefined;\n    if (props) {\n      return props;\n    }\n    props = new Map();\n    propCache.set(target, props);\n    var prop = props.get(property);\n    if (!prop) {\n      prop = Reflect.getOwnPropertyDescriptor(target, property);\n      props.set(property, prop);\n    }\n    return prop;\n  };\n  var invalidateCachedDescriptor = function (target, property) {\n    var props = propCache ? propCache.get(target) : undefined;\n    if (props) {\n      props.delete(property);\n    }\n  };\n  var buildProxy = function (value, path) {\n    if (isUnsubscribed) {\n      return value;\n    }\n    pathCache.set(value, path);\n    var proxy = proxyCache.get(value);\n    if (proxy === undefined) {\n      proxy = new Proxy(value, handler);\n      proxyCache.set(value, proxy);\n    }\n    return proxy;\n  };\n  var unsubscribe = function (target) {\n    isUnsubscribed = true;\n    propCache = null;\n    pathCache = null;\n    proxyCache = null;\n    return target;\n  };\n  var ignoreChange = function (property) {\n    return isUnsubscribed || (options.ignoreSymbols === true && typeof property === 'symbol');\n  };\n  var handler = {\n    get: function (target, property, receiver) {\n      if (property === proxyTarget || property === TARGET) {\n        return target;\n      }\n      if (property === UNSUBSCRIBE && pathCache.get(target) === '') {\n        return unsubscribe(target);\n      }\n      var value = Reflect.get(target, property, receiver);\n      if (\n        isPrimitive(value) ||\n        isBuiltinWithoutMutableMethods(value) ||\n        property === 'constructor' ||\n        options.isShallow === true\n      ) {\n        return value;\n      }\n      // Preserve invariants\n      var descriptor = getOwnPropertyDescriptor(target, property);\n      if (descriptor && !descriptor.configurable) {\n        if (descriptor.set && !descriptor.get) {\n          return undefined;\n        }\n        if (descriptor.writable === false) {\n          return value;\n        }\n      }\n      return buildProxy(value, concatPath(pathCache.get(target), property));\n    },\n    set: function (target, property, value, receiver) {\n      if (value && value[proxyTarget] !== undefined) {\n        value = value[proxyTarget];\n      }\n      var ignore = ignoreChange(property);\n      var previous = ignore ? null : Reflect.get(target, property, receiver);\n      var result = Reflect.set(target[proxyTarget] || target, property, value);\n      if (!ignore && !equals(previous, value)) {\n        handleChange(pathCache.get(target), property, previous, value);\n      }\n      return result;\n    },\n    defineProperty: function (target, property, descriptor) {\n      var result = Reflect.defineProperty(target, property, descriptor);\n      if (!ignoreChange(property)) {\n        invalidateCachedDescriptor(target, property);\n        handleChange(pathCache.get(target), property, undefined, descriptor.value);\n      }\n      return result;\n    },\n    deleteProperty: function (target, property) {\n      if (!Reflect.has(target, property)) {\n        return true;\n      }\n      var ignore = ignoreChange(property);\n      var previous = ignore ? null : Reflect.get(target, property);\n      var result = Reflect.deleteProperty(target, property);\n      if (!ignore) {\n        invalidateCachedDescriptor(target, property);\n        handleChange(pathCache.get(target), property, previous);\n      }\n      return result;\n    },\n    apply: function (target, thisArg, argumentsList) {\n      var compare = isBuiltinWithMutableMethods(thisArg);\n      if (compare) {\n        thisArg = thisArg[proxyTarget];\n      }\n      if (!inApply) {\n        inApply = true;\n        if (compare) {\n          applyPrevious = thisArg.valueOf();\n        }\n        if (Array.isArray(thisArg) || toString.call(thisArg) === '[object Object]') {\n          applyPrevious = shallowClone(thisArg[proxyTarget]);\n        }\n        applyPath = pathCache.get(target);\n        applyPath = applyPath.slice(0, Math.max(applyPath.lastIndexOf(PATH_SEPARATOR), 0));\n        var result = Reflect.apply(target, thisArg, argumentsList);\n        inApply = false;\n        if (changed || (compare && !equals(applyPrevious, thisArg.valueOf()))) {\n          handleChange(applyPath, '', applyPrevious, thisArg[proxyTarget] || thisArg);\n          applyPrevious = null;\n          changed = false;\n        }\n        return result;\n      }\n      return Reflect.apply(target, thisArg, argumentsList);\n    },\n  };\n  var proxy = buildProxy(object, '');\n  onChange = onChange.bind(proxy);\n  return proxy;\n};\nonChange.target = function (proxy) {\n  return proxy[TARGET] || proxy;\n};\nonChange.unsubscribe = function (proxy) {\n  return proxy[UNSUBSCRIBE] || proxy;\n};\nmodule.exports = onChange;\nexports.default = onChange;\n","import { Builder } from '@builder.io/sdk';\n\nconst nextTick = Builder.nextTick;\n\n// Plain function - e.g. const debounced = debounceNextTick(fn);\nexport function debounceNextTick(fn: (...args: any[]) => void): () => void;\n// Decorator - e.g. class Foo { @debounceNextTick myMethod() { ... } }\nexport function debounceNextTick(\n  target: any,\n  key: PropertyKey,\n  descriptor: PropertyDescriptor\n): PropertyDescriptor;\nexport function debounceNextTick(\n  target: object | ((...args: any[]) => void),\n  key?: PropertyKey,\n  descriptor?: PropertyDescriptor\n) {\n  if (typeof key === 'undefined' && typeof target === 'function') {\n    return debounceNextTickImpl(target as any);\n  }\n  return {\n    configurable: true,\n    enumerable: descriptor!.enumerable,\n    get: function getter(): any {\n      // Attach this function to the instance (not the class)\n      Object.defineProperty(this, key!, {\n        configurable: true,\n        enumerable: descriptor!.enumerable,\n        value: debounceNextTickImpl(descriptor!.value),\n      });\n\n      return (this as any)[key!];\n    },\n  } as PropertyDescriptor;\n}\n\nfunction debounceNextTickImpl(fn: (...args: any[]) => void) {\n  let args: any[] | null = null;\n  let context: any = null;\n\n  return debounced;\n\n  function debounced(this: any) {\n    const previous = args;\n    args = [].slice.call(arguments);\n    context = this;\n    if (previous !== null) return;\n    nextTick(next);\n  }\n\n  function next() {\n    fn.apply(context, args as any);\n    args = null;\n    context = null;\n  }\n}\n","export function throttle(func: Function, wait: number, options: any = {}) {\n  let context: any;\n  let args: any;\n  let result: any;\n  let timeout = null as any;\n  let previous = 0;\n  const later = function () {\n    previous = options.leading === false ? 0 : Date.now();\n    timeout = null;\n    result = func.apply(context, args);\n    if (!timeout) context = args = null;\n  };\n  return function (this: any) {\n    const now = Date.now();\n    if (!previous && options.leading === false) previous = now;\n    const remaining = wait - (now - previous);\n    context = this;\n    args = arguments;\n    if (remaining <= 0 || remaining > wait) {\n      if (timeout) {\n        clearTimeout(timeout);\n        timeout = null;\n      }\n      previous = now;\n      result = func.apply(context, args);\n      if (!timeout) context = args = null;\n    } else if (!timeout && options.trailing !== false) {\n      timeout = setTimeout(later, remaining);\n    }\n    return result;\n  };\n}\n","import React from 'react';\n\nexport const BuilderMetaContext = React.createContext({\n  emailMode: false,\n  ampMode: false,\n  isServer: false,\n});\n","'use client';\nimport { Builder } from '@builder.io/sdk';\nimport { safeDynamicRequire } from './safe-dynamic-require';\nimport { isDebug } from './is-debug';\nimport { getIsolateContext, makeFn } from './string-to-function';\nimport { shouldForceBrowserRuntimeInNode } from './should-force-browser-runtime-in-node';\n\nexport const tryEval = (str?: string, data: any = {}, errors?: Error[]): any => {\n  const value = str;\n  if (!(typeof value === 'string' && value.trim())) {\n    return;\n  }\n  const useReturn = !(value.includes(';') || value.includes(' return '));\n  let fn: Function = () => {\n    /* Intentionally empty */\n  };\n  try {\n    if (Builder.isBrowser) {\n      // tslint:disable-next-line:no-function-constructor-with-string-args\n      // TODO: VM in node......\n      fn = new Function(\n        'state',\n        // TODO: remove the with () {} - make a page v3 that doesn't use this\n        `var rootState = state;\n        if (typeof Proxy !== 'undefined') {\n          rootState = new Proxy(rootState, {\n            set: function () {\n              return false;\n            },\n            get: function (target, key) {\n              if (key === 'state') {\n                return state;\n              }\n              return target[key]\n            }\n          });\n        }\n        with (rootState) {\n          ${useReturn ? `return (${str});` : str};\n        }`\n      );\n    }\n  } catch (error: any) {\n    if (Builder.isBrowser) {\n      console.warn('Could not compile javascript', error);\n    } else {\n      // Add to req.options.errors to return to client\n    }\n  }\n  try {\n    if (Builder.isBrowser || shouldForceBrowserRuntimeInNode()) {\n      return fn(data || {});\n    } else {\n      // Below is a hack to get certain code to *only* load in the server build, to not screw with\n      // browser bundler's like rollup and webpack. Our rollup plugin strips these comments only\n      // for the server build\n      const ivm = safeDynamicRequire('isolated-vm');\n      const context = getIsolateContext();\n\n      Object.keys(data).forEach(key => {\n        switch (key) {\n          case 'state':\n          case 'global':\n          case 'log':\n            console.warn(`Not setting state.${key} as global ${key} in isolated vm`);\n            break;\n          default:\n            if (data[key] === undefined) {\n              return;\n            }\n            try {\n              if (typeof data[key] === 'object' && data[key] !== null) {\n                context.global.setSync(key, new ivm.ExternalCopy(data[key]).copyInto());\n              } else {\n                context.global.setSync(key, data[key]);\n              }\n            } catch (error) {\n              console.warn(`Could not set ${key} for isolated-vm:`, error);\n            }\n        }\n      });\n      const fnString = makeFn(str!, useReturn, ['state']);\n      const resultStr = context.evalClosureSync(fnString, [new ivm.Reference(data || {})]);\n      try {\n        // returning objects throw errors in isolated vm, so we stringify it and parse it back\n        return JSON.parse(resultStr);\n      } catch (_error: any) {\n        return resultStr;\n      }\n    }\n  } catch (error: any) {\n    if (errors) {\n      errors.push(error);\n    }\n\n    if (Builder.isBrowser) {\n      console.warn('Builder custom code error:', error.message, 'in', str, error.stack);\n    } else {\n      if (isDebug()) {\n        console.debug('Builder custom code error:', error.message, 'in', str, error.stack);\n      }\n      // Add to req.options.errors to return to client\n    }\n  } finally {\n    if (!(Builder.isBrowser || shouldForceBrowserRuntimeInNode())) {\n      const context = getIsolateContext();\n\n      // Clean up the global context\n      Object.keys(data).forEach(key => {\n        switch (key) {\n          case 'state':\n          case 'global':\n          case 'log':\n            break;\n          default:\n            context.global.deleteSync(key);\n        }\n      });\n    }\n  }\n\n  return;\n};\n","/**\n * Safe conversion to error type. Intended to be used in catch blocks where the\n *  value is not guaranteed to be an error.\n *\n *  @example\n *  try {\n *    throw new Error('Something went wrong')\n *  }\n *  catch (err: unknown) {\n *    const error: Error = toError(err)\n *  }\n */\nexport function toError(err: unknown): Error {\n  if (err instanceof Error) return err;\n  return new Error(String(err));\n}\n","import { BuilderElement } from '@builder.io/sdk';\n\nexport function getBuilderPixel(apiKey: string): BuilderElement {\n  return {\n    id: 'builder-pixel-' + Math.random().toString(36).split('.')[1],\n    '@type': '@builder.io/sdk:Element',\n    tagName: 'img',\n    properties: {\n      role: 'presentation',\n      'aria-hidden': 'true',\n      src: `https://cdn.builder.io/api/v1/pixel?apiKey=${apiKey}`,\n    },\n    responsiveStyles: {\n      large: {\n        height: '0',\n        width: '0',\n        display: 'inline-block',\n        opacity: '0',\n        overflow: 'hidden',\n        pointerEvents: 'none',\n      },\n    },\n  };\n}\n","'use client';\nimport React, { PropsWithChildren } from 'react';\nimport ReactDOM from 'react-dom';\nimport { jsx, css } from '@emotion/core';\nimport { BuilderContent, getContentWithInfo } from './builder-content.component';\nimport { BuilderBlocks } from './builder-blocks.component';\nimport {\n  Builder,\n  GetContentOptions,\n  builder,\n  Subscription,\n  BehaviorSubject,\n  BuilderElement,\n  BuilderContent as Content,\n  Component,\n} from '@builder.io/sdk';\nimport { BuilderStoreContext } from '../store/builder-store';\nimport hash from 'hash-sum';\nimport onChange from '../../lib/on-change';\n\nexport { onChange };\n\nimport { Breakpoints, getSizesForBreakpoints, Sizes } from '../constants/device-sizes.constant';\nimport {\n  BuilderAsyncRequestsContext,\n  RequestOrPromise,\n  RequestInfo,\n  isRequestInfo,\n} from '../store/builder-async-requests';\nimport { Url } from 'url';\nimport { debounceNextTick } from '../functions/debonce-next-tick';\nimport { throttle } from '../functions/throttle';\nimport { BuilderMetaContext } from '../store/builder-meta';\nimport { tryEval } from '../functions/try-eval';\nimport { toError } from '../to-error';\nimport { getBuilderPixel } from '../functions/get-builder-pixel';\nimport { isDebug } from '../functions/is-debug';\n\nexport type RegisteredComponent = Component & {\n  component?: React.ComponentType<any>;\n};\n\nfunction pick<T, K extends keyof T>(obj: T, ...keys: K[]): Pick<T, K> {\n  const ret: any = {};\n  keys.forEach(key => {\n    ret[key] = obj[key];\n  });\n  return ret;\n}\nfunction omit<T, K extends keyof T>(obj: T, ...keys: K[]): Omit<T, K> {\n  const ret: any = { ...obj };\n  keys.forEach(key => {\n    delete ret[key];\n  });\n  return ret;\n}\n\nconst instancesMap = new Map<string, Builder>();\n\nconst wrapComponent = (info: any) => {\n  return (props: any) => {\n    // TODO: convention for all of this, like builderTagProps={{ style: {} foo: 'bar' }}\n    const Tag = props.builderTag || 'div';\n    const inputNames = ['children'].concat(\n      info.inputs?.map((item: any) => item.name as string) || []\n    );\n\n    const baseProps = omit(props, ...inputNames, 'attributes');\n    const inputProps = props; // pick(props, ...inputNames);\n\n    if (info.noWrap) {\n      return <info.class attributes={baseProps} {...inputProps} />;\n    }\n\n    return (\n      <Tag {...baseProps}>\n        <info.class {...inputProps} />\n      </Tag>\n    );\n  };\n};\n\nconst size = (thing: object) => Object.keys(thing).length;\n\nfunction debounce(func: Function, wait: number, immediate = false) {\n  let timeout: any;\n  return function (this: any) {\n    const context = this;\n    const args = arguments;\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      timeout = null;\n      if (!immediate) func.apply(context, args);\n    }, wait);\n    if (immediate && !timeout) func.apply(context, args);\n  };\n}\n\nconst fontsLoaded = new Set();\n\nlet fetch: (typeof globalThis)['fetch'];\nif (globalThis.fetch) fetch = globalThis.fetch;\nfetch ??= require('node-fetch');\n\nconst sizeMap = {\n  desktop: 'large',\n  tablet: 'medium',\n  mobile: 'small',\n  xsmall: 'xsmall',\n};\n\nconst fetchCache: { [key: string]: any } = {};\n\nexport interface BuilderComponentProps {\n  /**\n   * @package\n   * @deprecated use {@link model} instead.\n   * @hidden\n   */\n  modelName?: string;\n  /**\n   * Name of the model this is rendering content for. Default is \"page\".\n   */\n  model?: string;\n  /**\n   * @package\n   * @deprecated use {@link model} instead.\n   * @hidden\n   */\n  name?: string;\n  /**\n   * Data is passed along as `state.*` to the component.\n   * @see {@link https://github.com/BuilderIO/builder/tree/master/packages/react#passing-data-and-functions-down}\n   *\n   * @example\n   * ```\n   * <BuilderComponent\n   *  model=\"page\"\n   *  data={{\n   *    products: productsList,\n   *    myFunction: () => alert('Triggered!'),\n   *    foo: 'bar'\n   *  }} >\n   * ```\n   */\n  data?: any;\n  /**\n   * Specific instance of Builder that should be used. You might use this for\n   * server side rendering. It's generally not recommended except for very\n   * advanced multi-tenant use cases.\n   */\n  builder?: Builder;\n  /**\n   * Content entry ID for this component to fetch client side\n   */\n  entry?: string;\n  /**\n   * @package\n   *\n   * Builder public API key.\n   *\n   * @see {@link builder.init()} for the preferred way of supplying your API key.\n   */\n  apiKey?: string;\n  /**\n   * @private\n   * @hidden\n   */\n  codegen?: boolean;\n  options?: GetContentOptions;\n  /**\n   * Function callback invoked with `data` and your content when it becomes\n   * available.\n   *\n   * @see {@link https://github.com/BuilderIO/builder/tree/master/packages/react#passing-data-and-functions-down}\n   */\n  contentLoaded?: (data: any, content: Content) => void;\n  /**\n   * Instead of having Builder render a link for you with plain anchor\n   * elements, use your own function. Useful when using Next.js, Gatsby, or\n   * other client side routers' custom `<Link>` components.\n   *\n   * ## Notes\n   *\n   * This must be a function that returns JSX, not a component!\n   *\n   * ## Examples\n   *\n   * @see {@link https://github.com/BuilderIO/builder/blob/0f0bc1ca835335f99fc21efb20ff3c4836bc9f41/examples/next-js-builder-site/src/functions/render-link.tsx#L6}\n   */\n  renderLink?: (props: React.AnchorHTMLAttributes<any>) => React.ReactNode;\n  /**\n   * Callback to run if an error occurred while fetching content.\n   */\n  contentError?: (error: any) => void;\n  /**\n   * Manually specify what Builder content JSON object to render. @see {@link\n   * https://github.com/BuilderIO/builder/tree/master/packages/react#passing-content-manually}\n   */\n  content?: Content;\n  /**\n   * @package\n   * @hidden\n   *\n   * Location object that provides the current url, path, etc; for server side\n   * rendering.\n   */\n  location?: Location | Url;\n  /**\n   * Callback to run when Builder state changes (e.g. state.foo = 'bar' in an\n   * action)\n   */\n  onStateChange?: (newData: any) => void;\n  /**\n   * @package\n   * @deprecated\n   * @hidden\n   */\n  noAsync?: boolean;\n  /**\n   * @package\n   * @hidden\n   *\n   * Flag to render email content (small differences in our render logic for\n   * email support).\n   */\n  emailMode?: boolean;\n  /**\n   * @package\n   * @hidden\n   *\n   * Flag to render amp content (small differences in our render logic for amp\n   * support)\n   */\n  ampMode?: boolean;\n  /**\n   * @package\n   * @hidden\n   *\n   * Render content in-line only (can't passed from the content prop) don't\n   * fetch content from our API.\n   */\n  inlineContent?: boolean;\n  /**\n   * @package\n   * @deprecated\n   * @hidden\n   */\n  builderBlock?: BuilderElement;\n  /**\n   * @package\n   * @deprecated\n   * @hidden\n   */\n  dataOnly?: boolean;\n  /**\n   * @package\n   * @deprecated\n   * @hidden\n   */\n  hydrate?: boolean;\n  /**\n   * @package\n   * @deprecated use {@link Builder.isStatic} instead\n   * @hidden\n   */\n  isStatic?: boolean;\n  /**\n   * Object that will be available in actions and bindings.\n   *\n   * @see {@link https://github.com/BuilderIO/builder/tree/master/packages/react#passing-data-and-functions-down}\n   */\n  context?: any;\n  /**\n   * @deprecated\n   * @hidden\n   */\n  url?: string;\n  /**\n   * @hidden\n   * Set to true if this is not the root content component, for instance for symbols\n   */\n  isChild?: boolean;\n  /**\n   * Set to true to not call `event.stopPropagation()` in the editor to avoid\n   * issues with client site routing triggering when editing in Builder, causing\n   * navigation to other pages unintended\n   */\n  stopClickPropagationWhenEditing?: boolean;\n\n  /**\n   * Set to the current locale in your application if you want localized inputs to be auto-resolved, should match one of the locales keys in your space settings\n   * Learn more about adding or removing locales [here](https://www.builder.io/c/docs/add-remove-locales)\n   */\n  locale?: string;\n\n  /**\n   * Pass a list of custom components to register with Builder.io.\n   */\n  customComponents?: Array<RegisteredComponent>;\n\n  /**\n   * CSP nonce to allow the loading and execution of a script or style tag when Content-Security-Policy is enabled.\n   */\n  nonce?: string;\n}\n\nexport interface BuilderComponentState {\n  state: any;\n  update: (state: any) => any;\n  updates: number;\n  context: any;\n  key: number;\n  breakpoints?: Breakpoints;\n}\n\ninterface BuilderRequest {\n  '@type': '@builder.io/core:Request';\n  request: {\n    url: string;\n    query?: { [key: string]: string };\n    headers?: { [key: string]: string };\n    method: 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE';\n    body?: any;\n  };\n  options?: { [key: string]: any };\n  bindings?: { [key: string]: string };\n}\n\nfunction searchToObject(location: Location | Url) {\n  const pairs = (location.search || '').substring(1).split('&');\n  const obj: { [key: string]: string } = {};\n\n  for (const i in pairs) {\n    if (!(pairs[i] && typeof pairs[i] === 'string')) {\n      continue;\n    }\n    const pair = pairs[i].split('=');\n    obj[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);\n  }\n\n  return obj;\n}\n\n/**\n * Responsible for rendering Builder content of type: 'page' or 'section' to\n * react components. It will attempt to fetch content from the API based on\n * defined user attributes (URL path, device type, and any custom targeting you set using `builder.setUserAttributes`) unless a `BuilderContent`\n * object is provided to `props.content`\n *\n * Use it to mount content in desired location, enable editing in place when\n * previewed in the editor.\n *\n * Supports server-side-rendering when passed the content json as\n * `props.content`.\n */\nexport class BuilderComponent extends React.Component<\n  PropsWithChildren<BuilderComponentProps>,\n  BuilderComponentState\n> {\n  static defaults: Pick<BuilderComponentProps, 'codegen'> = {\n    codegen: Boolean(Builder.isBrowser && location.href.includes('builder.codegen=true')),\n  };\n\n  subscriptions: Subscription = new Subscription();\n  // TODO: don't trigger initial one?\n  onStateChange = new BehaviorSubject<any>(null);\n  asServer = Builder.isServer;\n\n  contentRef: BuilderContent | null = null;\n\n  styleRef: HTMLStyleElement | null = null;\n\n  rootState = Builder.isServer ? {} : onChange({}, () => this.updateState());\n\n  lastJsCode = '';\n  lastHttpRequests: { [key: string]: string | undefined } = {};\n  httpSubscriptionPerKey: { [key: string]: Subscription | undefined } = {};\n  firstLoad = true;\n  ref: HTMLElement | null = null;\n\n  Component: any;\n\n  get options() {\n    // TODO: for perf cache this\n    return {\n      ...BuilderComponent.defaults,\n      ...this.props,\n    };\n  }\n\n  get name(): string | undefined {\n    return this.props.model || this.props.modelName || this.props.name; // || this.props.model\n  }\n\n  private _asyncRequests?: RequestOrPromise[];\n  private _errors?: Error[];\n  private _logs?: string[];\n  private sizes: Sizes;\n\n  get element() {\n    return this.ref;\n  }\n\n  get inlinedContent() {\n    if (this.isPreviewing && !this.props.inlineContent) {\n      return undefined;\n    }\n    return this.props.content;\n  }\n\n  constructor(props: BuilderComponentProps) {\n    super(props);\n\n    let _content: any = this.inlinedContent;\n    if (_content && _content.content) {\n      _content = _content.content;\n    }\n\n    this.sizes = getSizesForBreakpoints(_content?.meta?.breakpoints || {});\n\n    // TODO: pass this all the way down - symbols, etc\n    // this.asServer = Boolean(props.hydrate && Builder.isBrowser)\n    const contentData = this.inlinedContent?.data;\n    if (contentData && Array.isArray(contentData.inputs) && contentData.inputs.length > 0) {\n      if (!contentData.state) {\n        contentData.state = {};\n      }\n      // set default values of content inputs on state\n      contentData.inputs.forEach((input: any) => {\n        if (input) {\n          if (\n            input.name &&\n            input.defaultValue !== undefined &&\n            contentData.state![input.name] === undefined\n          ) {\n            contentData.state![input.name] = input.defaultValue;\n          }\n        }\n      });\n    }\n    this.state = {\n      // TODO: should change if this prop changes\n      context: {\n        ...props.context,\n        apiKey: this.props.apiKey || builder.apiKey,\n        nonce: this.props.nonce,\n      },\n      state: Object.assign(this.rootState, {\n        ...(this.inlinedContent && this.inlinedContent.data && this.inlinedContent.data.state),\n        isBrowser: Builder.isBrowser, // !this.asServer,\n        isServer: !Builder.isBrowser, // this.asServer,\n        _hydrate: props.hydrate,\n        location: this.locationState,\n        deviceSize: this.deviceSizeState,\n        // TODO: will user attributes be ready here?\n        device: this.device,\n        ...this.getHtmlData(),\n        ...props.data,\n      }),\n      updates: 0,\n      key: 0,\n      update: this.updateState,\n    };\n\n    const key = this.props.apiKey;\n    if (key && key !== this.builder.apiKey && !instancesMap.has(key)) {\n      // We create a builder instance for each api key to support loading of symbols from other spaces\n      const instance = new Builder(key, undefined, undefined, true);\n      instancesMap.set(key, instance);\n    }\n\n    if (this.inlinedContent) {\n      // Sometimes with graphql we get the content as `content.content`\n      const content = (this.inlinedContent as any).content || this.inlinedContent;\n      this.onContentLoaded(content?.data, getContentWithInfo(content)!);\n    }\n\n    this.registerCustomComponents();\n  }\n\n  get builder() {\n    const instance = this.props.apiKey && instancesMap.get(this.props.apiKey);\n    return instance || this.props.builder || builder;\n  }\n\n  getHtmlData() {\n    const id = (this.inlinedContent && this.inlinedContent.id) || this.props.entry;\n    const script =\n      id &&\n      Builder.isBrowser &&\n      document.querySelector(\n        `script[data-builder-json=\"${id}\"],script[data-builder-state=\"${id}\"]`\n      );\n    if (script) {\n      try {\n        const json = JSON.parse((script as HTMLElement).innerText);\n        return json;\n      } catch (err) {\n        console.warn(\n          'Could not parse Builder.io HTML data transfer',\n          err,\n          (script as HTMLElement).innerText\n        );\n      }\n    }\n    return {};\n  }\n\n  // TODO: pass down with context\n  get device() {\n    return this.builder.getUserAttributes().device || 'desktop';\n  }\n\n  get locationState() {\n    return {\n      // TODO: handle this correctly on the server. Pass in with CONTEXT\n      ...pick(this.location, 'pathname', 'hostname', 'search', 'host'),\n      path: (this.location.pathname && this.location.pathname.split('/').slice(1)) || '',\n      query: searchToObject(this.location),\n    };\n  }\n\n  // TODO: trigger state change on screen size change\n  get deviceSizeState() {\n    // TODO: use context to pass this down on server\n    return Builder.isBrowser\n      ? this.sizes.getSizeForWidth(window.innerWidth)\n      : sizeMap[this.device] || 'large';\n  }\n\n  messageListener = (event: MessageEvent) => {\n    const isTrusted = Builder.isTrustedHostForEvent(event);\n    if (!isTrusted) return;\n\n    const info = event.data;\n    switch (info.type) {\n      case 'builder.configureSdk': {\n        const data = info.data;\n\n        if (!data.contentId || data.contentId !== this.useContent?.id) {\n          return;\n        }\n\n        this.sizes = getSizesForBreakpoints(data.breakpoints || {});\n\n        this.setState({\n          state: Object.assign(this.rootState, {\n            deviceSize: this.deviceSizeState,\n            // TODO: will user attributes be ready here?\n            device: this.device,\n          }),\n          updates: ((this.state && this.state.updates) || 0) + 1,\n          breakpoints: data.breakpoints,\n        });\n\n        break;\n      }\n\n      case 'builder.updateSpacer': {\n        const data = info.data;\n        const currentSpacer = this.rootState._spacer;\n        this.updateState(state => {\n          state._spacer = data;\n        });\n        break;\n      }\n      case 'builder.resetState': {\n        const { state, model } = info.data;\n        if (model === this.name) {\n          for (const key in this.rootState) {\n            // TODO: support nested functions (somehow)\n            if (typeof this.rootState[key] !== 'function') {\n              delete this.rootState[key];\n            }\n          }\n          Object.assign(this.rootState, state);\n          this.setState({\n            ...this.state,\n            state: this.rootState,\n            updates: ((this.state && this.state.updates) || 0) + 1,\n          });\n        }\n        break;\n      }\n      case 'builder.resetSymbolState': {\n        const { state, model, id } = info.data.state;\n        if (this.props.builderBlock && this.props.builderBlock === id) {\n          for (const key in this.rootState) {\n            delete this.rootState[key];\n          }\n          Object.assign(this.rootState, state);\n          this.setState({\n            ...this.state,\n            state: this.rootState,\n            updates: ((this.state && this.state.updates) || 0) + 1,\n          });\n        }\n        break;\n      }\n    }\n  };\n\n  resizeFn = () => {\n    const deviceSize = this.deviceSizeState;\n    if (deviceSize !== this.state.state.deviceSize) {\n      this.setState({\n        ...this.state,\n        updates: ((this.state && this.state.updates) || 0) + 1,\n        state: Object.assign(this.rootState, {\n          ...this.state.state,\n          deviceSize,\n        }),\n      });\n    }\n  };\n\n  resizeListener = Builder.isEditing ? throttle(this.resizeFn, 200) : debounce(this.resizeFn, 400);\n\n  static renderInto(\n    elementOrSelector: string | HTMLElement,\n    props: BuilderComponentProps = {},\n    hydrate = true,\n    fresh = false\n  ) {\n    console.debug('BuilderPage.renderInto', elementOrSelector, props, hydrate, this);\n\n    if (!elementOrSelector) {\n      return;\n    }\n\n    let element: Element | null = null;\n\n    if (typeof elementOrSelector === 'string') {\n      element = document.querySelector(elementOrSelector);\n    } else {\n      if (elementOrSelector instanceof Element) {\n        element = elementOrSelector;\n      }\n    }\n\n    if (!element) {\n      return;\n    }\n\n    const exists = element.classList.contains('builder-hydrated');\n    if (exists && !fresh) {\n      console.debug('Tried to hydrate multiple times');\n      return;\n    }\n    element.classList.add('builder-hydrated');\n\n    let shouldHydrate = hydrate && element.innerHTML.includes('builder-block');\n\n    if (!element.classList.contains('builder-component')) {\n      // TODO: maybe remove any builder-api-styles...\n      const apiStyles =\n        element.querySelector('.builder-api-styles') ||\n        (element.previousElementSibling &&\n        element.previousElementSibling.matches('.builder-api-styles')\n          ? element.previousElementSibling\n          : null);\n      let keepStyles = '';\n      if (apiStyles) {\n        const html = apiStyles.innerHTML;\n        html.replace(\n          /\\/\\*start:([^\\*]+?)\\*\\/([\\s\\S]*?)\\/\\*end:([^\\*]+?)\\*\\//g,\n          (match, id, content) => {\n            let el: HTMLElement | null = null;\n            try {\n              el = document.querySelector(`[data-emotion-css=\"${id}\"]`);\n            } catch (err) {\n              console.warn(err);\n            }\n            if (el) {\n              el.innerHTML = content;\n            } else if (!Builder.isEditing) {\n              keepStyles += match;\n            }\n\n            return match;\n          }\n        );\n        // NextTick? or longer timeout?\n        Builder.nextTick(() => {\n          apiStyles.innerHTML = keepStyles;\n        });\n      }\n      const useElement = element.querySelector('.builder-component');\n      if (useElement) {\n        element = useElement;\n      } else {\n        shouldHydrate = false;\n      }\n    }\n\n    if (location.search.includes('builder.debug=true')) {\n      console.debug('hydrate', shouldHydrate, element);\n    }\n\n    let useEl = element;\n    if (!exists) {\n      const div = document.createElement('div');\n      element.insertAdjacentElement('beforebegin', div);\n      div.appendChild(element);\n      useEl = div;\n    }\n\n    if (Builder.isEditing || (Builder.isBrowser && location.search.includes('builder.preview='))) {\n      shouldHydrate = false;\n    }\n    if (shouldHydrate && element) {\n      // TODO: maybe hydrate again. Maybe...\n      const val = ReactDOM.render(\n        <BuilderComponent {...props} />,\n        useEl,\n        (useEl as any).builderRootRef\n      );\n      (useEl as any).builderRootRef = val;\n      return val;\n    }\n    const val = ReactDOM.render(\n      <BuilderComponent {...props} />,\n      useEl,\n      (useEl as any).builderRootRef\n    );\n    (useEl as any).builderRootRef = val;\n    return val;\n  }\n\n  mounted = false;\n\n  registerCustomComponents() {\n    if (this.props.customComponents) {\n      for (const customComponent of this.props.customComponents) {\n        if (customComponent) {\n          const { component, ...registration } = customComponent;\n          Builder.registerComponent(component, registration);\n        }\n      }\n    }\n  }\n\n  componentDidMount() {\n    this.mounted = true;\n    if (this.asServer) {\n      this.asServer = false;\n      this.updateState(state => {\n        state.isBrowser = true;\n        state.isServer = false;\n      });\n    }\n\n    if (Builder.isIframe) {\n      window.parent?.postMessage(\n        {\n          type: 'builder.sdkInjected',\n          data: { modelName: this.name, apiKey: this.props.apiKey || builder.apiKey },\n        },\n        '*'\n      );\n    }\n\n    if (Builder.isBrowser) {\n      // TODO: remove event on unload\n      window.addEventListener('resize', this.resizeListener);\n      if (Builder.isEditing) {\n        window.addEventListener('message', this.messageListener);\n      }\n\n      if (Builder.isEditing || Builder.isPreviewing) {\n        Builder.nextTick(() => {\n          this.firstLoad = false;\n          this.reload();\n        });\n      }\n\n      setTimeout(() => {\n        window.dispatchEvent(\n          new CustomEvent('builder:component:load', {\n            detail: {\n              ref: this,\n            },\n          })\n        );\n      });\n    }\n  }\n\n  updateState = (fn?: (state: any) => void) => {\n    const state = this.rootState;\n    if (fn) {\n      fn(state);\n    }\n    if (this.mounted) {\n      this.setState({\n        update: this.updateState,\n        state,\n        updates: ((this.state && this.state.updates) || 0) + 1,\n      });\n    } else {\n      this.state = {\n        ...this.state,\n        update: this.updateState,\n        state,\n        updates: ((this.state && this.state.updates) || 0) + 1,\n      };\n    }\n\n    this.notifyStateChange();\n  };\n\n  get isPreviewing() {\n    return (\n      (Builder.isServer || (Builder.isBrowser && Builder.isPreviewing && !this.firstLoad)) &&\n      (builder.previewingModel === this.name || builder.previewingModel === 'BUILDER_STUDIO')\n    );\n  }\n\n  @debounceNextTick\n  notifyStateChange() {\n    if (Builder.isServer) {\n      return;\n    }\n    if (!(this && this.state)) {\n      return;\n    }\n    const nextState = this.state.state;\n    // TODO: only run the below once per tick...\n    if (this.props.onStateChange) {\n      this.props.onStateChange(nextState);\n    }\n\n    if (Builder.isBrowser) {\n      window.dispatchEvent(\n        new CustomEvent('builder:component:stateChange', {\n          detail: {\n            state: nextState,\n            ref: this,\n          },\n        })\n      );\n    }\n    this.onStateChange.next(nextState);\n  }\n\n  processStateFromApi(state: { [key: string]: any }) {\n    return state; //  mapValues(state, value => tryEval(value, this.data, this._errors))\n  }\n\n  get location() {\n    return this.props.location || (Builder.isBrowser ? location : ({} as any));\n  }\n\n  getCssFromFont(font: any, data?: any) {\n    // TODO: compute what font sizes are used and only load those.......\n    const family = font.family + (font.kind && !font.kind.includes('#') ? ', ' + font.kind : '');\n    const name = family.split(',')[0];\n    const url = font.fileUrl ? font.fileUrl : font.files && font.files.regular;\n    let str = '';\n    if (url && family && name) {\n      str += `\n@font-face {\n  font-family: \"${family}\";\n  src: local(\"${name}\"), url('${url}') format('woff2');\n  font-display: fallback;\n  font-weight: 400;\n}\n        `.trim();\n    }\n\n    if (font.files) {\n      for (const weight in font.files) {\n        const isNumber = String(Number(weight)) === weight;\n        if (!isNumber) {\n          continue;\n        }\n        // TODO: maybe limit number loaded\n        const weightUrl = font.files[weight];\n        if (weightUrl && weightUrl !== url) {\n          str += `\n@font-face {\n  font-family: \"${family}\";\n  src: url('${weightUrl}') format('woff2');\n  font-display: fallback;\n  font-weight: ${weight};\n}\n          `.trim();\n        }\n      }\n    }\n    return str;\n  }\n\n  componentWillUnmount() {\n    this.unsubscribe();\n    if (Builder.isBrowser) {\n      window.removeEventListener('resize', this.resizeListener);\n      window.removeEventListener('message', this.messageListener);\n    }\n  }\n\n  getFontCss(data?: any) {\n    if (!this.builder.allowCustomFonts) {\n      return '';\n    }\n    // TODO: separate internal data from external\n    return (\n      (data?.customFonts &&\n        data.customFonts.length &&\n        data.customFonts.map((font: any) => this.getCssFromFont(font, data)).join(' ')) ||\n      ''\n    );\n  }\n\n  ensureFontsLoaded(data?: any) {\n    if (this.builder.allowCustomFonts && data?.customFonts && Array.isArray(data.customFonts)) {\n      for (const font of data.customFonts) {\n        const url = font.fileUrl ? font.fileUrl : font.files && font.files.regular;\n        if (!fontsLoaded.has(url)) {\n          const html = this.getCssFromFont(font, data);\n          fontsLoaded.add(url);\n          if (!html) {\n            continue;\n          }\n          const style = document.createElement('style');\n          style.className = 'builder-custom-font';\n          style.setAttribute('data-builder-custom-font', url);\n          style.innerHTML = html;\n          document.head.appendChild(style);\n        }\n      }\n    }\n  }\n\n  getCss(data?: any) {\n    const contentId = this.useContent?.id;\n    let cssCode = data?.cssCode || '';\n    if (contentId) {\n      // Allow using `&` in custom CSS code like @emotion\n      // E.g. `& .foobar { ... }` to scope CSS\n      // TODO: handle if '&' is within a string like `content: \"&\"`\n      cssCode = cssCode.replace(/&/g, `.builder-component-${contentId}`);\n    }\n\n    return cssCode + this.getFontCss(data);\n  }\n\n  get data() {\n    const data = {\n      ...(this.inlinedContent && this.inlinedContent.data?.state),\n      ...this.externalState,\n      ...this.state.state,\n    };\n    Object.assign(this.rootState, data);\n    return data;\n  }\n\n  componentDidUpdate(prevProps: BuilderComponentProps) {\n    // TODO: shallow diff\n    if (this.props.data && prevProps.data !== this.props.data) {\n      this.state.update((state: any) => {\n        Object.assign(state, this.externalState);\n      });\n    }\n\n    if (this.props.customComponents && this.props.customComponents !== prevProps.customComponents) {\n      this.registerCustomComponents();\n    }\n\n    if (Builder.isEditing) {\n      if (this.inlinedContent && prevProps.content !== this.inlinedContent) {\n        this.onContentLoaded(this.inlinedContent.data, this.inlinedContent);\n      }\n    }\n  }\n\n  // FIXME: workaround to issue with CSS extraction and then hydration\n  // (might be preact only)\n  checkStyles(data: any) {\n    if (this.styleRef) {\n      const css = this.getCss(data);\n      if (this.styleRef.innerHTML !== css) {\n        this.styleRef.innerHTML = css;\n      }\n    }\n  }\n\n  reload() {\n    this.setState({\n      key: this.state.key + 1,\n    });\n  }\n\n  get content() {\n    let content = this.inlinedContent;\n    if (content && (content as any).content) {\n      // GraphQL workaround\n      content = {\n        ...content,\n        data: (content as any).content,\n      };\n    }\n    return content;\n  }\n\n  get externalState() {\n    return {\n      ...this.props.data,\n      ...(this.props.locale ? { locale: this.props.locale } : {}),\n    };\n  }\n\n  get useContent() {\n    return this.content || this.state.context.builderContent;\n  }\n\n  render() {\n    const content = this.content;\n\n    const dataString =\n      Builder.isBrowser &&\n      this.externalState &&\n      size(this.externalState) &&\n      hash(this.externalState);\n    let key = Builder.isEditing ? this.name : this.props.entry;\n    if (key && !Builder.isEditing && dataString && dataString.length < 300) {\n      key += ':' + dataString;\n    }\n\n    const WrapComponent = this.props.dataOnly ? React.Fragment : 'div';\n\n    const contentId = this.useContent?.id;\n\n    return (\n      // TODO: data attributes for model, id, etc?\n      <WrapComponent\n        onClick={event => {\n          // Prevent propagation from the root content component when editing to prevent issues\n          // like client side routing triggering when links are clicked, unless this behavior is\n          // disabled with the stopClickPropagationWhenEditing prop\n          if (\n            Builder.isEditing &&\n            !this.props.isChild &&\n            !this.props.stopClickPropagationWhenEditing\n          ) {\n            event.stopPropagation();\n          }\n        }}\n        className={`builder-component ${contentId ? `builder-component-${contentId}` : ''}`}\n        data-name={this.name}\n        data-source=\"Rendered by Builder.io\"\n        key={this.state.key}\n        ref={ref => (this.ref = ref)}\n      >\n        <BuilderMetaContext.Consumer>\n          {value => (\n            <BuilderMetaContext.Provider\n              value={\n                typeof this.props.ampMode === 'boolean'\n                  ? {\n                      ...value,\n                      ampMode: this.props.ampMode,\n                    }\n                  : value\n              }\n            >\n              <BuilderAsyncRequestsContext.Consumer>\n                {value => {\n                  this._asyncRequests = value && value.requests;\n                  this._errors = value && value.errors;\n                  this._logs = value && value.logs;\n\n                  return (\n                    <BuilderContent\n                      isStatic={this.props.isStatic || Builder.isStatic}\n                      key={\n                        this.inlinedContent?.id ||\n                        ('content' in this.props && !this.isPreviewing\n                          ? 'null-content-prop'\n                          : 'no-content-prop')\n                      }\n                      builder={this.builder}\n                      ref={ref => (this.contentRef = ref)}\n                      // TODO: pass entry in\n                      contentLoaded={(data, content) => this.onContentLoaded(data, content)}\n                      options={{\n                        key,\n                        entry: this.props.entry,\n                        ...(content && { initialContent: [content] }),\n                        ...(!content &&\n                          'content' in this.props &&\n                          !this.isPreviewing && { initialContent: [] }),\n                        ...(this.props.url && { url: this.props.url }),\n                        ...this.props.options,\n                        ...(this.props.locale ? { locale: this.props.locale } : {}),\n                        ...(this.options.codegen && {\n                          format: 'react',\n                        }),\n                      }}\n                      inline={\n                        this.props.inlineContent || (!this.isPreviewing && 'content' in this.props)\n                      }\n                      contentError={this.props.contentError}\n                      modelName={this.name || 'page'}\n                      nonce={this.props.nonce}\n                    >\n                      {(data, loading, fullData) => {\n                        if (this.props.dataOnly) {\n                          return null;\n                        }\n                        if (fullData && fullData.id) {\n                          if (this.state.breakpoints) {\n                            fullData.meta = fullData.meta || {};\n                            fullData.meta.breakpoints = this.state.breakpoints;\n                          }\n                          this.state.context.builderContent = fullData;\n                        }\n                        if (Builder.isBrowser) {\n                          Builder.nextTick(() => {\n                            this.checkStyles(data);\n                          });\n                        }\n\n                        const { codegen } = this.options;\n\n                        if (codegen && !this.Component && data?.blocksJs) {\n                          const builderComponentNames: string[] = Array.from(\n                            new Set(Builder.components.map((item: any) => item.name))\n                          );\n                          const reversedcomponents = Builder.components.slice().reverse();\n\n                          const builderComponents = builderComponentNames.map(name =>\n                            reversedcomponents.find((item: any) => item.class && item.name === name)\n                          );\n\n                          const useBuilderState = (initialState: any) => {\n                            const [, setTick] = React.useState(0);\n                            const [state] = React.useState(() =>\n                              onChange(initialState, function () {\n                                setTick(tick => tick + 1);\n                              })\n                            );\n\n                            return state;\n                          };\n\n                          const mappedComponentNames = builderComponentNames.map(name =>\n                            (name || '').replace(/[^\\w]+/gi, '')\n                          );\n\n                          const finalizedComponents = builderComponents.map(info =>\n                            wrapComponent(info)\n                          );\n\n                          this.Component = new Function(\n                            'jsx',\n                            '_css',\n                            'Builder',\n                            'builder',\n                            'React',\n                            'useBuilderState',\n                            ...mappedComponentNames,\n                            data.blocksJs\n                          )(\n                            jsx,\n                            css,\n                            Builder,\n                            builder,\n                            React,\n                            useBuilderState,\n                            ...finalizedComponents\n                          );\n                        }\n\n                        const blocks = data?.blocks || [];\n\n                        const hasPixel = blocks.find((block: BuilderElement) =>\n                          block.id?.startsWith('builder-pixel')\n                        );\n\n                        if (data && !hasPixel && blocks.length > 0) {\n                          blocks.push(getBuilderPixel(builder.apiKey!));\n                        }\n\n                        // TODO: loading option - maybe that is what the children is or component prop\n                        // TODO: get rid of all these wrapper divs\n                        return data ? (\n                          <div\n                            data-builder-component={this.name}\n                            data-builder-content-id={fullData.id}\n                            {...(this.isPreviewing\n                              ? {\n                                  'data-builder-variation-id':\n                                    fullData.testVariationId || fullData.variationId || fullData.id,\n                                }\n                              : {})}\n                          >\n                            {!codegen && this.getCss(data) && (\n                              <style\n                                nonce={this.props.nonce}\n                                ref={ref => (this.styleRef = ref)}\n                                className=\"builder-custom-styles\"\n                                dangerouslySetInnerHTML={{\n                                  __html: this.getCss(data),\n                                }}\n                              />\n                            )}\n                            <BuilderStoreContext.Provider\n                              value={{\n                                ...this.state,\n                                rootState: this.rootState,\n                                state: this.data,\n                                content: fullData,\n                                renderLink: this.props.renderLink,\n                              }}\n                            >\n                              {codegen && this.Component ? (\n                                <this.Component data={this.data} context={this.state.context} />\n                              ) : (\n                                <BuilderBlocks\n                                  key={String(!!data?.blocks?.length)}\n                                  emailMode={this.props.emailMode}\n                                  fieldName=\"blocks\"\n                                  blocks={blocks}\n                                />\n                              )}\n                            </BuilderStoreContext.Provider>\n                          </div>\n                        ) : loading ? (\n                          <div data-builder-component={this.name} className=\"builder-loading\">\n                            {this.props.children}\n                          </div>\n                        ) : (\n                          <div data-builder-component={this.name} className=\"builder-no-content\" />\n                        );\n                      }}\n                    </BuilderContent>\n                  );\n                }}\n              </BuilderAsyncRequestsContext.Consumer>\n            </BuilderMetaContext.Provider>\n          )}\n        </BuilderMetaContext.Consumer>\n      </WrapComponent>\n    );\n  }\n\n  evalExpression(expression: string) {\n    const { data } = this;\n    return String(expression).replace(/{{([^}]+)}}/g, (match, group) =>\n      tryEval(group, data, this._errors)\n    );\n  }\n\n  async handleRequest(\n    propertyName: string,\n    httpRequest: {\n      url: string;\n      method: 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH';\n      body?: any;\n      headers?: Record<string, string>;\n    }\n  ) {\n    const { url, method, body, headers } = httpRequest;\n\n    const fetchCacheKey = JSON.stringify({ url, method, body, headers });\n    // TODO: Builder.isEditing = just checks if iframe and parent page is this.builder.io or localhost:1234\n    if (Builder.isIframe && fetchCache[fetchCacheKey]) {\n      this.updateState(ctx => {\n        ctx[propertyName] = fetchCache[fetchCacheKey];\n      });\n      return fetchCache[fetchCacheKey];\n    }\n    const request = async () => {\n      const requestStart = Date.now();\n      if (!Builder.isBrowser) {\n        console.time('Fetch ' + fetchCacheKey);\n      }\n      let json: any;\n      try {\n        const fetchOptions = {\n          method,\n          headers,\n          body,\n        };\n        if (method === 'GET') {\n          delete fetchOptions.body;\n        }\n        const result = await fetch(url, fetchOptions);\n        json = await result.json();\n      } catch (err) {\n        const error = toError(err);\n        if (this._errors) {\n          this._errors.push(error);\n        }\n        if (this._logs) {\n          this._logs.push(`Fetch to ${fetchCacheKey} errored in ${Date.now() - requestStart}ms`);\n        }\n        return;\n      } finally {\n        if (!Builder.isBrowser) {\n          console.timeEnd('Fetch ' + fetchCacheKey);\n          if (this._logs) {\n            this._logs.push(`Fetched ${fetchCacheKey} in ${Date.now() - requestStart}ms`);\n          }\n        }\n      }\n\n      if (json) {\n        if (Builder.isIframe) {\n          fetchCache[fetchCacheKey] = json;\n        }\n        // TODO: debounce next tick all of these when there are a bunch\n        this.updateState(ctx => {\n          ctx[propertyName] = json;\n        });\n      }\n\n      return json;\n    };\n    const existing =\n      this._asyncRequests &&\n      (this._asyncRequests.find(\n        req => isRequestInfo(req) && req.url === url\n      ) as RequestInfo | null);\n    if (existing) {\n      const promise = existing.promise;\n      promise.then(json => {\n        if (json) {\n          this.updateState(ctx => {\n            ctx[propertyName] = json;\n          });\n        }\n      });\n      return promise;\n    }\n    const promise = request();\n    Builder.nextTick(() => {\n      if (this._asyncRequests) {\n        this._asyncRequests.push(promise);\n      }\n    });\n    return promise;\n  }\n\n  unsubscribe() {\n    if (this.subscriptions) {\n      this.subscriptions.unsubscribe();\n      this.subscriptions = new Subscription();\n    }\n  }\n\n  handleBuilderRequest(propertyName: string, optionsString: string) {\n    const options = tryEval(optionsString, this.data, this._errors);\n    // TODO: this will screw up for multiple bits of data\n    if (this.subscriptions) {\n      this.unsubscribe();\n    }\n    // TODO: don't unsubscribe and resubscribe every time data changes, will make a TON of requests if that's the case when editing...\n    // I guess will be cached then\n    if (options) {\n      // TODO: unsubscribe on destroy\n      this.subscriptions.add(\n        this.builder.queueGetContent(options.model, options).subscribe(matches => {\n          if (matches) {\n            this.updateState(ctx => {\n              ctx[propertyName] = matches;\n            });\n          }\n        })\n      );\n    }\n  }\n\n  onContentLoaded = (data: any, content: Content) => {\n    if (this.name === 'page' && Builder.isBrowser) {\n      if (data) {\n        const { title, pageTitle, description, pageDescription } = data;\n\n        if (title || pageTitle) {\n          document.title = title || pageTitle;\n        }\n\n        if (description || pageDescription) {\n          let descriptionTag = document.querySelector('meta[name=\"description\"]');\n\n          if (!descriptionTag) {\n            descriptionTag = document.createElement('meta');\n            descriptionTag.setAttribute('name', 'description');\n            document.head.appendChild(descriptionTag);\n          }\n\n          descriptionTag.setAttribute('content', description || pageDescription);\n        }\n      }\n    }\n\n    if (Builder.isEditing) {\n      this.notifyStateChange();\n    }\n\n    if (this.props.contentLoaded) {\n      this.props.contentLoaded(data, content);\n    }\n\n    if (data && data.inputs && Array.isArray(data.inputs) && data.inputs.length) {\n      if (!data.state) {\n        data.state = {};\n      }\n\n      data.inputs.forEach((input: any) => {\n        if (input) {\n          if (\n            input.name &&\n            input.defaultValue !== undefined &&\n            data.state[input.name] === undefined\n          ) {\n            data.state[input.name] = input.defaultValue;\n          }\n        }\n      });\n    }\n\n    if (data && data.state) {\n      const newState = {\n        ...this.state,\n        updates: ((this.state && this.state.updates) || 0) + 1,\n        state: Object.assign(this.rootState, {\n          ...this.state.state,\n          location: this.locationState,\n          device: this.device,\n          ...data.state,\n          ...this.externalState,\n          deviceSize: this.deviceSizeState,\n        }),\n      };\n      if (this.mounted) {\n        this.setState(newState);\n      } else {\n        this.state = newState;\n      }\n    }\n\n    // TODO: also throttle on edits maybe\n    if (data && data.jsCode && !this.options.codegen) {\n      // Don't rerun js code when editing and not changed\n      let skip = false;\n      if (Builder.isEditing) {\n        if (this.lastJsCode === data.jsCode) {\n          skip = true;\n        } else {\n          this.lastJsCode = data.jsCode;\n        }\n      }\n\n      if (!skip) {\n        const state = this.state.state;\n\n        // TODO: real editing method\n        try {\n          const result = new Function(\n            'data',\n            'ref',\n            'state',\n            'update',\n            'element',\n            'Builder',\n            'builder',\n            'context',\n            data.jsCode\n          )(data, this, state, this.state.update, this.ref, Builder, builder, this.state.context);\n\n          // TODO: allow exports = { } syntax?\n          // TODO: do something with reuslt like view - methods, computed, actions, properties, template, etc etc\n        } catch (err) {\n          const error = toError(err);\n          if (Builder.isBrowser) {\n            console.warn(\n              'Builder custom code error:',\n              error.message,\n              'in',\n              data.jsCode,\n              error.stack\n            );\n          } else {\n            if (isDebug()) {\n              console.debug(\n                'Builder custom code error:',\n                error.message,\n                'in',\n                data.jsCode,\n                error.stack\n              );\n            }\n            // Add to req.options.errors to return to client\n          }\n        }\n      }\n    }\n\n    if (data && data.httpRequests /* || data.builderData @DEPRECATED */ && !this.props.noAsync) {\n      // Don't rerun http requests when editing and not changed\n      // No longer needed?\n      let skip = false;\n\n      if (!skip) {\n        // TODO: another structure for this\n        for (const key in data.httpRequests) {\n          const httpRequest: BuilderRequest | string | undefined = data.httpRequests[key];\n          if (httpRequest && (!this.data[key] || Builder.isEditing)) {\n            const isCoreRequest =\n              typeof httpRequest === 'object' &&\n              httpRequest['@type'] === '@builder.io/core:Request';\n            if (Builder.isBrowser) {\n              const finalUrl = isCoreRequest\n                ? this.evalExpression(httpRequest.request.url)\n                : this.evalExpression(httpRequest as string);\n\n              if (Builder.isEditing && this.lastHttpRequests[key] === finalUrl) {\n                continue;\n              }\n              this.lastHttpRequests[key] = finalUrl;\n\n              if (isCoreRequest) {\n                this.handleRequest(key, {\n                  url: finalUrl,\n                  method: httpRequest.request.method,\n                  body: httpRequest.request.body,\n                  headers: httpRequest.request.headers,\n                });\n              } else {\n                this.handleRequest(key, {\n                  url: finalUrl,\n                  method: 'GET',\n                });\n              }\n              const currentSubscription = this.httpSubscriptionPerKey[key];\n              if (currentSubscription) {\n                currentSubscription.unsubscribe();\n              }\n\n              // TODO: fix this\n              const newSubscription = (this.httpSubscriptionPerKey[key] =\n                this.onStateChange.subscribe(() => {\n                  const newUrl = isCoreRequest\n                    ? this.evalExpression(httpRequest.request.url)\n                    : this.evalExpression(httpRequest as string);\n                  if (newUrl !== finalUrl) {\n                    if (isCoreRequest) {\n                      this.handleRequest(key, {\n                        url: newUrl,\n                        method: httpRequest.request.method,\n                        body: httpRequest.request.body,\n                        headers: httpRequest.request.headers,\n                      });\n                    } else {\n                      this.handleRequest(key, {\n                        url: newUrl,\n                        method: 'GET',\n                      });\n                    }\n                    this.lastHttpRequests[key] = newUrl;\n                  }\n                }));\n              this.subscriptions.add(newSubscription);\n            } else {\n              if (isCoreRequest) {\n                this.handleRequest(key, {\n                  url: this.evalExpression(httpRequest.request.url),\n                  method: httpRequest.request.method,\n                  body: httpRequest.request.body,\n                  headers: httpRequest.request.headers,\n                });\n              } else {\n                this.handleRequest(key, {\n                  url: this.evalExpression(httpRequest as string),\n                  method: 'GET',\n                });\n              }\n            }\n          }\n        }\n      }\n    }\n  };\n}\n","'use client';\nimport React from 'react';\nimport { BuilderElement } from '@builder.io/sdk';\nimport { BuilderBlock } from '../components/builder-block.component';\n\nconst isBuilderElement = (item: unknown): item is BuilderElement => {\n  return Boolean(\n    typeof item === 'object' && item && (item as any)?.['@type'] === '@builder.io/sdk:Element'\n  );\n};\n\n/**\n * Higher order component for passing Builder.io children as React children\n *\n * @example\n * ```tsx\n *\n *    const MyButton = props => <Button>\n *      {children}\n *    </Button>\n *\n *    const ButtonWithBuilderChildren = withChildren(MyButton)\n *\n *    Builder.registerComponent(ButtonWithBuilderChildren, {\n *      name: 'MyButton',\n *      defaultChildren: [\n *        {\n *          '@type': '@builder.io/sdk:Element'\n *        }\n *      ]\n *    })\n * ```\n */\nexport const withChildren = <P extends object>(Component: React.ComponentType<P>) => {\n  const HOC = React.forwardRef<any, React.PropsWithChildren<P> & { builderBlock?: BuilderElement }>(\n    (props, ref) => {\n      const useProps = { ...props };\n      const children =\n        props.children ||\n        (props.builderBlock &&\n          props.builderBlock.children &&\n          props.builderBlock.children.map(child => <BuilderBlock key={child.id} block={child} />));\n\n      const componentOptions = props.builderBlock?.component?.options;\n      if (!!componentOptions) {\n        Object.keys(componentOptions).forEach(key => {\n          const value = componentOptions[key];\n          if (Array.isArray(value) && value.every(isBuilderElement)) {\n            useProps[key] = value.map(child => <BuilderBlock key={child.id} block={child} />);\n          } else if (isBuilderElement(value)) {\n            useProps[key] = <BuilderBlock block={value} />;\n          }\n        });\n      }\n\n      return (\n        // getting type errors due to `@types/react` version mismatches. Can safely ignore.\n        // @ts-ignore\n        <Component {...useProps} ref={ref}>\n          {children}\n        </Component>\n      );\n    }\n  );\n\n  (HOC as any).builderOptions = {\n    canHaveChildren: true,\n  };\n\n  return HOC;\n};\n","import { useEffect, useState } from 'react';\nimport { Builder } from '@builder.io/sdk';\n\nexport function useIsPreviewing() {\n  const [isPreviewing, setIsPreviewing] = useState(false);\n\n  useEffect(() => {\n    if (Builder.isEditing || Builder.isPreviewing) {\n      setIsPreviewing(true);\n    }\n  }, []);\n\n  return isPreviewing;\n}\n","import './scripts/init-editing';\n\nimport { builder, Builder } from '@builder.io/sdk';\nexport { BuilderElement } from '@builder.io/sdk';\n\nBuilder.isReact = true;\n\nexport { BuilderBlocks } from './components/builder-blocks.component';\nexport { BuilderBlock as BuilderBlockComponent } from './components/builder-block.component';\nexport { BuilderContent } from './components/builder-content.component';\nimport { BuilderComponent } from './components/builder-component.component';\nexport { BuilderStoreContext } from './store/builder-store';\nexport { BuilderMetaContext } from './store/builder-meta';\nexport { BuilderAsyncRequestsContext } from './store/builder-async-requests';\nexport { withChildren } from './functions/with-children';\n\nexport { BuilderComponent as BuilderPage };\nexport { BuilderComponent };\n\nexport { stringToFunction } from './functions/string-to-function';\nexport { useIsPreviewing } from './hooks/useIsPreviewing';\n\nexport { builder, Builder };\nexport default builder;\n"],"names":["SDK_VERSION","window","_a","parent","postMessage","type","data","value","supportsPatchUpdates","supportsCustomBreakpoints","supportsXSmallBreakpoint","supportsGlobalSymbols","blockLevelPersonalization","version","fastClone","obj","JSON","parse","stringify","sizeNames","sizes","xsmall","min","default","max","small","medium","large","getWidthForSize","size","this","getSizeForWidth","width","sizeNames_1","_i","length","getSizesForBreakpoints","breakpoints","newSizes","xsmallMin","Math","floor","smallMin","mediumMin","largeMin","set","_path","Object","path","Array","isArray","toString","match","slice","reduce","a","c","i","abs","Number","noop","safeDynamicRequire","globalThis","require","Builder","isServer","eval","e","isDebug","Boolean","process","env","DEBUG","isNodeRuntime","versions","node","shouldForceBrowserRuntimeInNode","isArm64","arch","isNode20","startsWith","hasNoNodeSnapshotNodeOption","NODE_OPTIONS","includes","console","log","fnCache","api","state","builder","stringToFunction","str","expression","errors","logs","trim","cacheKey","useReturn","fn","isBrowser","Function","concat","error","push","message","indexOf","warn","final","args","arguments","apply","isolateContext","getIsolateContext","ivm_1","resultStr","evalClosureSync","makeFn","map","arg","index","Reference","indexOfBuilderInstance","getUserAttributes","res","_error","stack","debug","code","names","join","isolatedContext","serverContext","Isolate","memoryLimit","createContextSync","setServerContext","jail","global","setSync","derefInto","isPromise","thing","then","isRequestInfo","BuilderAsyncRequestsContext","React","createContext","requests","BuilderStoreContext","rootState","content","context","update","mutator","applyPatchWithMinimalMutationChain","patch","preserveRoot","op","pathArr","split","shift","newObj","__assign","objPart","isLast","property","splice","nextProperty","newPart","String","__spreadArray","htmlEscape","replace","blockToHtmlString","block","tagName","id","class","keys","properties","key","component","name","options","text","children","item","Link","props","Consumer","renderLink","createElement","traverse","callback","visited","WeakSet","has","add","forEach","newValue","entries","isLocalizedField","containsLocalizedValues","getOwnPropertyNames","hasLocalizedValues","extractLocalizedValues","locale","undefined","camelCaseToKebabCase","g","toLowerCase","kebabCaseToCamelCase","toUpperCase","Device","desktop","tablet","mobile","deepCloneWithConditions","clonedObj","prototype","hasOwnProperty","call","meta","voidElements","Set","last","arr","omit","values","newObject","assign","values_1","cssCase","capitalize","BuilderBlock","_super","_this","hydrated","hasError","updates","privateState","onWindowMessage","event","selection","setTimeout","$block","$blocks","patches","location","href","patches_1","setState","__extends","defineProperty","get","getDerivedStateFromError","componentDidCatch","errorInfo","_errors","_logs","emotionCss","responsiveStyles","initialAnimationStepStyles","animation","animations","trigger","firstStep","steps","stepStyles","styles","reversedNames","reverse","contentHasXSmallBreakpoint","_b","builderContent","_c","reversedNames_1","emailMode","sizesPerBreakpoints","_e","_d","&.builder-block","hoverAnimation","find","_f","transition","duration","easing","delay","transitionDelay","componentWillUnmount","isEditing","removeEventListener","componentDidMount","addEventListener","bindings","animator","bindAnimations","filter","elementId","getElement","_g","child","fieldName","InnerComponent","TagName","html","jsx","dangerouslySetInnerHTML","__html","componentName","componentInfo","tag","components","style","hide","show","actions","useState","Proxy","prop","innerComponentProperties","isVoid","noWrap","fragment","styleStr","attr","styleSplit_1","stylePieces","finalOptions","_spacer","builder-index","memo","Fragment","ClassNames","css","cx","addClass","className","_asyncRequests","attributes","builderBlock","builderState","contents","repeat","collection","collectionPath","collectionName","itemName_1","itemName","array","childState","$index","$item","Provider","render","display","padding","color","fontSize","fontStyle","Component","BuilderBlocks","onClickEmptyBlocks","isIframe","noBlocks","parentElementId","parentId","dataPath","onHoverEmptyBlocks","blocks","builder-type","builder-path","builder-parent-id","flexDirection","alignItems","onClick","onMouseEnter","renderInto","elementOrSelector","element","document","querySelector","Element","ReactDOM","NoWrap","getData","blocksString","hasBlocks","newData","variantsScript","variantsString","contentId","VariantsProvider","initialContent","nonce","canTrack","variations","variants","allVariants","variantsJson_1","testRatio","cookieName","variantId","getCookie","n","random","variant","setCookie","BuilderContent","ref","loading","getContentWithInfo","isTrusted","isTrustedHostForEvent","noEditorUpdates","contentLoaded","subscriptions","Subscription","firstLoad","clicked","trackedImpression","intersectionObserver","reactEvent","nativeEvent","autoTrack","trackInteraction","renderedVariantId","model","modelName","isStatic","variationId","isPreviewing","inline","subscribeToContent","contentData","trackImpression","queueGetContent","subscribe","matches","editingModel","previewingModel","unsubscribe","addedObserver","IntersectionObserver","observer","entry","intersectionRatio","unobserve","observe","err","contentError","dataOnly","useData","renderScript","Tag","data-template-variant-id","builder-content-id","builder-model","cookieValue","cookieVariation","variationName","testVariationId","testVariationName","exports","TARGET","Symbol","UNSUBSCRIBE","concatPath","shallowClone","onChange","object","applyPath","applyPrevious","proxyTarget","inApply","changed","isUnsubscribed","equals","is","propCache","WeakMap","pathCache","proxyCache","handleChange","previous","item_1","walkPath","invalidateCachedDescriptor","target","delete","buildProxy","proxy","handler","ignoreChange","ignoreSymbols","receiver","Reflect","isPrimitive","RegExp","isBuiltinWithoutMutableMethods","isShallow","descriptor","Map","getOwnPropertyDescriptor","configurable","writable","ignore","result","deleteProperty","thisArg","argumentsList","compare","Date","valueOf","lastIndexOf","bind","module","nextTick","debounceNextTick","debounceNextTickImpl","enumerable","next","throttle","func","wait","timeout","later","leading","now","remaining","clearTimeout","trailing","BuilderMetaContext","ampMode","tryEval","context_1","ExternalCopy","copyInto","fnString","context_2","deleteSync","toError","Error","getBuilderPixel","apiKey","@type","role","aria-hidden","src","height","opacity","overflow","pointerEvents","pick","ret","instancesMap","wrapComponent","info","builderTag","inputNames","inputs","baseProps","inputProps","debounce","immediate","fontsLoaded","fetch","sizeMap","fetchCache","searchToObject","pairs","search","substring","pair","decodeURIComponent","BuilderComponent","onStateChange","BehaviorSubject","asServer","contentRef","styleRef","updateState","lastJsCode","lastHttpRequests","httpSubscriptionPerKey","messageListener","useContent","deviceSize","deviceSizeState","device","data_1","resizeFn","resizeListener","mounted","notifyStateChange","onContentLoaded","title","pageTitle","description","pageDescription","descriptionTag","setAttribute","head","appendChild","input","defaultValue","newState","locationState","externalState","jsCode","codegen","skip","httpRequests","noAsync","httpRequest","isCoreRequest_1","finalUrl_1","evalExpression","request","url","handleRequest","method","body","headers","currentSubscription","newSubscription","newUrl","_content","inlinedContent","_hydrate","hydrate","getHtmlData","instance","registerCustomComponents","defaults","inlineContent","script","innerText","pathname","query","innerWidth","fresh","exists","classList","contains","shouldHydrate","innerHTML","apiStyles_1","previousElementSibling","keepStyles_1","el","useElement","useEl","div","insertAdjacentElement","val_1","builderRootRef","val","customComponents","customComponent","registration","__rest","registerComponent","reload","dispatchEvent","CustomEvent","detail","nextState","processStateFromApi","getCssFromFont","font","family","kind","fileUrl","files","regular","weight","weightUrl","getFontCss","allowCustomFonts","customFonts","ensureFontsLoaded","getCss","cssCode","componentDidUpdate","prevProps","checkStyles","css_1","dataString","hash","WrapComponent","isChild","stopClickPropagationWhenEditing","stopPropagation","data-source","format","fullData","blocksJs","builderComponentNames","from","reversedcomponents_1","builderComponents","mappedComponentNames","finalizedComponents","initialState","setTick","tick","hasPixel","data-builder-content-id","data-builder-variation-id","data-builder-component","group","propertyName","fetchCacheKey","ctx","__awaiter","requestStart","time","fetchOptions","sent","json","err_1","timeEnd","existing","req","promise_1","promise","handleBuilderRequest","optionsString","__decorate","isBuilderElement","withChildren","HOC","forwardRef","useProps","componentOptions","every","builderOptions","canHaveChildren","useIsPreviewing","setIsPreviewing","useEffect","isReact"],"mappings":"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"}